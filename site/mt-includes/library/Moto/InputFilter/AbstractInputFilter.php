<?php
namespace Moto\InputFilter; use Zend\InputFilter\InputFilter; use Zend\InputFilter\Exception; use Moto; class AbstractInputFilter extends InputFilter { protected $_defaultsValue = null; protected $_name; public function __construct() { $this->init(); if ($this->_name !== null) { Moto\Hook::trigger(Moto\Hook::INPUT_FILTER_CREATED, $this); } } public function getName() { return $this->_name; } public function getMessagesKeys($elementName = null) { $messages = parent::getMessages($elementName); $findMessagesKeys = function(array $tree) use (&$findMessagesKeys) { $result = array(); foreach($tree as $key => $value) { if (is_string($key) && $key[0] === '@') { $key = substr($key, 1); $result[] = array( 'name' => $key, 'errors' => $value, ); continue; } if (is_array($value)) { $result[$key] = $findMessagesKeys($tree[$key]); } elseif (is_string($value)) { $result[] = $key; } } return $result; }; $messages = $findMessagesKeys($messages); return $messages; } public function setData($data) { if (is_array($this->_defaultsValue)) { $data = array_merge($this->_defaultsValue, $data); } return parent::setData($data); } public function getValues($keys = null, $ignoreDefault = false) { $values = parent::getValues(); if (is_bool($keys)) { $ignoreDefault = $keys; } if ($ignoreDefault) { if (is_array($this->data)) { $diffKeys = array_diff(array_keys($values), array_keys($this->data)); if (is_array($diffKeys)) { foreach ($diffKeys as $key) { unset($values[$key]); } } } } if (is_array($keys)) { $_values = array(); foreach ($keys as $key) { if (array_key_exists($key, $values)) { $_values[$key] = $values[$key]; } } $values = $_values; } return $values; } }