"use strict";function defer_expr(e,t){var r;e()?t():r=setInterval(function(){e()&&(clearInterval(r),t())},0)}function sortArrayByProperty(e,t){return e.sort(function(e,r){return e[t]<r[t]?-1:e[t]>r[t]?1:0})}angular.module("core.library",[]),angular.module("core.library.deviceDetection",[]).run(["deviceDetectionService","$document",function(e,t){e.isMobileDevice()?angular.element(t[0].body).addClass("moto-mobile-device"):angular.element(t[0].body).addClass("moto-desktop-device")}]),angular.module("core.library.dragDrop",[]),angular.module("core.library.editor.history",[]).run(["EditorHistoryManager",function(e){e.registerAction({name:"createWidget",inverseName:"removeWidget",run:function(e,t,r){e._silentMode=!0,e.ContentManager.insertOrMoveWidgetByOptions({droppedWidgetOptions:{isNew:!0,options:{properties:t.properties,children:angular.copy(t.children),widgetId:t.id},widgetName:t.name},targetConfig:{targetWidgetId:t.parent,indexInContainer:t.position},needToSelect:!1,callback:function(){e._silentMode=!1,r()}})}}),e.registerAction({name:"removeWidget",inverseName:"createWidget",run:function(e,t,r){var n,i=e.getWidgetById(t.id);e.HistoryManager.isUndoInProcess()&&!t.properties&&(n=i.exportForHistory(),t.name=n.name,t.properties=n.properties,t.parent=n.parent,t.position=n.position,n.children&&(t.children=n.children)),e.destroyWidget(t.id),r()}}),e.registerAction({name:"setProperties",run:function(e,t,r){var n,i,o=e.getWidgetById(t.id);if(o){if(n=e.HistoryManager.isUndoInProcess()?t.undoProperties:t.redoProperties,e.HistoryManager.isUndoInProcess()&&!t.redoProperties){t.redoProperties={};for(i in n)n.hasOwnProperty(i)&&(t.redoProperties[i]=angular.copy(o.properties[i]))}o.setProperties(n).then(r)}else r()}}),e.registerAction({name:"moveWidget",run:function(e,t,r){var n=e.getWidgetById(t.id),i=e.HistoryManager.isUndoInProcess(),o=n.getLocationInEditor(),a=i?t.undoTargetWidgetId:t.redoTargetWidgetId,s=i?t.undoIndexInContainer:t.redoIndexInContainer;i&&!t.redoTargetWidgetId&&(t.redoTargetWidgetId=o.parentWidgetId,t.redoIndexInContainer=o.indexInContainer),o.parentWidgetId===a&&s>o.indexInContainer&&s++,e.ContentManager.insertOrMoveWidgetByOptions({droppedWidgetOptions:{widget:n,widgetName:n.name},targetConfig:{targetWidgetId:a,indexInContainer:s},needToSelect:!1,callback:r})}})}]),angular.module("core.library.editor",["core.library.jsonrpc","core.library.config","core.library.interceptors","core.library.Features","motoUI.Menu","core.library.editor.history"]).value("MotoEditorValues",{copiedWidget:null}),angular.module("core.library.interceptors",[]),angular.module("core.library.messenger",["ngSanitize"]),angular.module("core.library.utils",["core.library.modal","core.library.config"]),angular.module("core.library.validate",["pascalprecht.translate"]),angular.module("core.library.viewportInitialScale",[]),angular.module("core.library.Accounts",["core.library.utils","core.library.storage","core.library.languages","angular-jwt"]).provider("coreLibraryAccounts",["coreLibraryUtilsProvider","coreLibraryLanguagesProvider","coreLibraryConfigProvider","$translateProvider",function(e,t,r,n){function i(e){l.debug&&(console.warn("Accounts send",e),console.warn("message.data",e.data),console.warn("message.origin",e.origin),console.warn("message.lastEventId",e.lastEventId),console.warn("message.source",e.source),console.warn("message.ports",e.ports),window.$lastPostMessage=e),s?s._processMessage(e):l.debug&&console.warn("serviceInstance not found")}function o(e,t,r,n){this._$rootScope=e,this._$location=t,this._jwtHelper=r,this._MotoLocalStorage=n,this._initRawAccessToken()}var a,s,u=this,l={debug:!1,expOffset:21600,appId:"",authUrl:"",productInfoUrl:""};u.setOptions=function(e){var t;if(!angular.isObject(e))return!1;for(t in e)e.hasOwnProperty(t)&&this.setOption(t,e[t]);return!0},u.setOption=function(t,r){return!!angular.isString(t)&&(!angular.isUndefined(l[t])&&(e.getTypeOff(l[t])===e.getTypeOff(r)&&(l[t]=r,!0)))},window.addEventListener?window.addEventListener("message",i,!1):window.attachEvent("onmessage",i),o.prototype._accessToken="",o.prototype._$rootScope=null,o.prototype._jwtHelper=null,o.prototype._MotoLocalStorage=null,o.prototype._initRawAccessToken=function(){this._accessToken=this._MotoLocalStorage.getValue("module-accounts-access_token"),this.isExpiredToken()&&this.dropAccessToken()},o.prototype._processMessage=function(e){var t,r;return l.debug&&console.info("_processMessage (event)",e),e instanceof MessageEvent?"https://accounts.motocms.com"!==e.origin?(l.debug&&console.info('_processMessage : ignore by "origin"'),!1):(t=e.data,angular.isString(t)&&(t=angular.fromJson(t)),angular.isObject(t)?"accounts"!==t.module?(l.debug&&console.info('_processMessage : ignore by "message.module"'),!1):angular.isObject(t.body)?angular.isString(t.action)&&t.action.length?("setToken"===t.action&&(r=t.body.access_token,this.setAccessToken(r)),void("setProductInfo"===t.action&&this._$rootScope.$broadcast("$motoAccounts.ProductInfoWasReceived",t.body.productInfo))):(l.debug&&console.info('_processMessage : ignore by "message.action"'),!1):(l.debug&&console.info('_processMessage : ignore by "message.body"'),!1):(l.debug&&console.info("_processMessage : message not object",t),!1)):(l.debug&&console.info('_processMessage : ignore by "instanceof"'),!1)},o.prototype.dropAccessToken=function(){this._accessToken="",this._MotoLocalStorage.setValue("module-accounts-access_token","")},o.prototype._decodeToken=function(e){try{return angular.isUndefined(e)&&(e=this._accessToken),angular.isString(e)?this._jwtHelper.decodeToken(e):null}catch(e){}return null},o.prototype.setAccessToken=function(e){var t=this._decodeToken(e);return l.debug&&(console.info("setAccessToken : token",e),console.info("setAccessToken : token",t)),!!t&&(this._accessToken=e,this._$rootScope.$broadcast("$motoAccounts.AccessTokenWasChanged",e),this._MotoLocalStorage.setValue("module-accounts-access_token",e),!0)},o.prototype.getAccessToken=function(){return this._accessToken},o.prototype.isTokenExists=function(){return!!this._decodeToken()},o.prototype.isExpiredToken=function(){return!this.isTokenExists()||this._jwtHelper.isTokenExpired(this._accessToken,l.expOffset)},o.prototype.getTokenExpirationDate=function(){var e=null;return this.isTokenExists()&&(e=this._jwtHelper.getTokenExpirationDate(this._accessToken)),e instanceof Date&&e.setTime(e.getTime()-1e3*l.expOffset),e},o.prototype.getTokenData=function(e){var t=this._decodeToken();return t?angular.isDefined(e)?angular.isString(e)?t[e]:null:t:null},o.prototype.setDefaultProductInformation=function(e){a=e},o.prototype.encodeRequest=function(t){var r;return angular.isObject(t)?(r=angular.toJson(t),r=e.base64Encode(r)):null},o.prototype.getAuthUrl=function(e){var r=l.authUrl;return l.debug&&console.info('getAuthUrl : "productInformation"',e),l.debug&&console.info('getAuthUrl : "_options.authUrl"',l.authUrl),angular.isUndefined(e)&&(e=a),angular.isObject(e)?(r+="?app_id="+l.appId,r+="&lang="+t.getProfileCode(),r+="&language_locale="+t.getProfileLocale(),r+="&request="+encodeURIComponent(this.encodeRequest(e)),l.debug&&console.info("getAuthUrl : return",r),r):null},o.prototype.getProductInfoUrl=function(){var t=l.productInfoUrl,i=r.get("currentTheme"),o=i?i.template_id:"",a=r.get("environment",{});return a.location=this._$location.absUrl(),a.currentTheme=i,t+="?app_id="+l.appId,t+="&language_locale="+n.use(),t+="&template_id="+o,t+="&environment="+encodeURIComponent(e.base64Encode(angular.toJson(a)))},this.$get=["$rootScope","$location","jwtHelper","MotoLocalStorage",function(e,t,r,n){return s||(s=new o(e,t,r,n)),s}]}]),angular.module("core.library.brand",["pascalprecht.translate","core.library.Features","kr.ngNamespaceUrl"]),angular.module("core.library.brand").provider("motoBrand",["$translateProvider","motoFeaturesProvider","$namespaceUrlProvider",function(e,t,r){function n(e,t,r){if(angular.isUndefined(r)&&(r=null),!angular.isObject(e))return r;if(!angular.isUndefined(e[t]))return e[t];var i=angular.isArray(t)?t:t.split("."),o=i.shift();return angular.isUndefined(e[o])?r:n(e[o],i,r)}var i=this,o=!1,a={},s={};i.getMediaUrl=s.getMediaUrl=function(e){var t=n(a.media,e),i="@adminImages/"+e;return t&&(i=t.path),r.url(i)},i.addTranslations=function(t){angular.isObject(t)&&(angular.isUndefined(t.BRAND)&&(t={BRAND:t}),e.translations("en_US",t),e.translations("en",t),e.translations(t))},i.addFeatures=function(e){angular.isObject(e)&&t.addList(e)},i.getName=function(){return a.name},s.getName=i.getName,i.bootstrap=function(e){o||(a=e,angular.isObject(a.features)&&i.addFeatures(a.features),angular.isObject(a.translations)&&i.addTranslations(a.translations),o=!0)},this.$get=[function(){return s}]}]);try{angular.module("application.config.value")}catch(e){angular.module("application.config.value",["ng"]).constant("application.config.value",null)}angular.module("core.library.config",["application.config.value"]).provider("coreLibraryConfig",["application.config.value",function(e){function t(e,t){var r,n,i=[],o=null;for(e&&angular.isString(e)&&(o=s,i=e.split("."),n=t?i.length-1:i.length),r=0;r<n;r++){if(!i[r]||!o.hasOwnProperty(i[r])){o=null;break}o=o[i[r]]}return t&&o&&o.hasOwnProperty(i[r])&&(o=o[i[r]]=angular.copy(t)),o}function r(e,t,r){var n,i,o,a;if(angular.isNumber(t)){if(isNaN(t))return r;t+=""}if(!angular.isString(t)||t.length<1)return r;if(angular.isDefined(e[t]))return e[t];a=t.split(".");try{for(i=e,n=0,o=a.length;n<o;n++)angular.isDefined(i)&&(i=i[a[n]]);if(angular.isDefined(i))return i}catch(e){}return r}function n(e,t){var r,n,i;if(angular.isNumber(t)){if(isNaN(t))return!1;t+=""}if(!angular.isString(t)||t.length<1)return!1;if(angular.isDefined(e[t]))return!0;for(r=0,n=(i=t.split(".")).length;r<n;r++){if(angular.isUndefined(e[i[r]]))return!1;e=e[i[r]]}return!0}function i(e,t,r){var n,i,o,a;if(angular.isNumber(t)){if(isNaN(t))return!1;t+=""}if(!angular.isString(t)||t.length<1)return!1;if(angular.isDefined(e[t]))return e[t]=r;o=t.split(".");try{for(n=0,i=o.length;n<i&&(a=o[n],n!==i-1);n++){if(angular.isUndefined(e[a]))e[a]={};else if(!angular.isObject(e[a])||angular.isArray(e[a]))return!1;e=e[a]}e[a]=r}catch(e){console.error(e)}return!0}var o,a=this,s={},u=!1,l=!1,c=!0,d="production",p=(new Date).getTime(),f=!1;s=angular.isObject(e)?e:app.config||s,angular.isDefined(s.env)&&-1!==["development","testing"].indexOf(s.env)&&(d=s.env),u="development"===d,l="testing"===d,c="production"===d,angular.isDefined(s.isDemoMode)&&(f=s.isDemoMode),o=r(s,"settings.website.features"),angular.isString(o)&&(o=angular.fromJson(o),angular.isObject(o)&&(s.settings.website.features=o)),o=r(s,"__features__"),angular.isString(o)&&(o=angular.fromJson(o),angular.isObject(o)&&(s.__features__=o)),this.isDevelopment=function(){return u},this.isTesting=function(){return l},this.isProduction=function(){return c},this.isDemoMode=function(){return f},this.getStage=function(){return d},this.get=function(e,t){var n;return(n=r(s,e,t))&&(n=angular.copy(n)),n},this.exists=function(e){return n(s,e)},this.update=function(e,t){try{t=angular.copy(t)}catch(e){return!1}return app&&app.config&&i(app.config,e,t),i(s,e,t)},this.getBuild=function(){return parseInt(r(s,"settings.system.build",p))},this.getVersion=function(){return r(s,"settings.system.version","3.1.6")},this.key=function(e){return s.hasOwnProperty(e)?s[e]:null},this.keyPath=function(e,r){return t(e)||(angular.isDefined(r)?r:null)},this.setValueByPath=function(e,r){return!(!angular.isDefined(r)||!t(e,r))},this.$get=[function(){return{isDevelopment:a.isDevelopment,isTesting:a.isTesting,isProduction:a.isProduction,isDemoMode:a.isDemoMode,getStage:a.getStage,get:a.get,exists:a.exists,update:a.update,getBuild:a.getBuild,getVersion:a.getVersion,key:a.key,keyPath:a.keyPath,setValueByPath:a.setValueByPath}}]}]),angular.module("core.library").service("coreLibraryContentSection",["jsonrpc",function(e){var t=e.newService("ContentSection");this.getSettings=t.createMethod("getSettings"),this.setSettings=t.createMethod("setSettings")}]),angular.module("core.library.CurrentValue",[]).service("CurrentValue",[function(){var e={};return{get:function(t,r,n){return e.hasOwnProperty(t)&&e[t].hasOwnProperty(r)?e[t][r]:n},set:function(t,r,n){var i=this;return e.hasOwnProperty(t)||(e[t]={}),e[t][r]=n,i},clear:function(t,r){e.hasOwnProperty(t)&&delete e[t][r]}}}]),angular.module("core.library.deviceDetection").service("deviceDetectionService",["viewportInitialScaleService",function(e){var t={};return t.isMobileDevice=function(){return t.isTouchDevice()&&!e.isDesktop()},t.isDesktopDevice=function(){return!t.isMobileDevice()},t.isTouchDevice=function(){return Boolean("ontouchstart"in window||navigator.maxTouchPoints)},t}]),angular.module("core.library.dragDrop").provider("dragDropBoxService",function(){this.$get=[function(){var e,t,r,n,i,o,a,s=[];return r=function(e,t,r,n,o,a,s,u,l,c,d,p,f,g){e.font=o+"px Calibri";var h=e.measureText(t).width;d&&(e.fillStyle=f),p&&(e.strokeStyle=g),e.strokeStyle="#1f34f6",i(e,r-l,n-o+o/5-c-u,h+2*l,o+2*u,s,d,p),e.fillStyle=a,e.fillText(t,r,n)},i=function(e,t,r,n,i,o,a,s){angular.isUndefined(s)&&(s=!0),angular.isUndefined(o)&&(o=5),e.beginPath(),e.moveTo(t+o,r),e.lineTo(t+n-o,r),e.quadraticCurveTo(t+n,r,t+n,r+o),e.lineTo(t+n,r+i-o),e.quadraticCurveTo(t+n,r+i,t+n-o,r+i),e.lineTo(t+o,r+i),e.quadraticCurveTo(t,r+i,t,r+i-o),e.lineTo(t,r+o),e.quadraticCurveTo(t,r,t+o,r),e.closePath(),s&&e.stroke(),a&&e.fill()},n=function(t,n){(o=document.createElement("canvas")).width=80,o.height=50,(a=o.getContext("2d")).drawImage(e,0,0),r(a,t,30,45,15,"#FFF",3,2,7,0,!0,!1,"#ffab26","#fff111"),s[n]=document.createElement("img"),s[n].src=o.toDataURL()},{drawItemsInCanvas:function(e,t){n(e,t)},init:function(){(e=new Image).crossOrigin="anonymous",e.src=app.config.getUrl("@adminImages/drag-files-image.png"),e.onload=function(){n(1,0)},(t=new Image).src=app.config.getUrl("@adminImages/drag-folder-img.png")},itemsBox:function(){var e,t;return e=function(e){t=e},e.setDragImage=function(e){e.originalEvent.dataTransfer.setDragImage&&(t?e.originalEvent.dataTransfer.setDragImage(s[0],-2,25):e.originalEvent.dataTransfer.setDragImage(s[1],-2,25))},e},foldersBox:function(){var e;return e=function(){},e.setDragImage=function(e){e.originalEvent.dataTransfer.setDragImage&&e.originalEvent.dataTransfer.setDragImage(t,-8,15)},e}}}]}),angular.module("core.library.dragDrop").directive("ngDragDropConfig",[function(){return{restrict:"A",link:function(e,t,r){var n,i,o,a,s,u,l,c,d,p=!1;u=t[0],l=function(){return u.hasOwnProperty("$$ngDragDropItem")?u.$$ngDragDropItem:null},s=function(e){var r,n=l();if("dragstart"==e.type&&(c&&d.apply(c,[n,e,t]),e.originalEvent.dataTransfer.effectAllowed="move",e.originalEvent.dataTransfer.dropEffect="move",u.attachEvent||navigator.userAgent.match(/Trident.*rv\:11\./)?e.originalEvent.dataTransfer.setData("Text",t.html()):e.originalEvent.dataTransfer.setData("text/html",t.html()),c.hasOwnProperty("box")?c.box instanceof Function?c.box.setDragImage(e):"object"==typeof c.box?e.originalEvent.dataTransfer.setDragImage&&e.originalEvent.dataTransfer.setDragImage(c.box,-12,8):e.originalEvent.dataTransfer.setDragImage&&e.originalEvent.dataTransfer.setDragImage(t.context,-12,8):e.originalEvent.dataTransfer.setDragImage&&e.originalEvent.dataTransfer.setDragImage(t.context,-12,8)),c&&(c.cssClass&&("dragenter"!=e.type&&"dragover"!=e.type||("string"==typeof c.cssClass?t.addClass(c.cssClass):c.cssClass instanceof Function&&(r=c.cssClass).apply(c,[e.type,t,e])),"dragleave"!=e.type&&"drop"!=e.type||("string"==typeof c.cssClass?t.removeClass(c.cssClass):c.cssClass instanceof Function&&(r=c.cssClass).apply(c,[e.type,t,e]))),c.hasOwnProperty(e.type)&&(r=c[e.type])instanceof Function))return r.apply(c,[n,e])},o=function(){p||(t.on("drag",s),t.on("dragstart",s),t.on("dragenter",s),t.on("dragleave",s),t.on("dragover",s),t.on("dragend",s),t.on("drop",s),p=!0)},a=function(){p&&(t.off("drag",s),t.off("dragstart",s),t.off("dragenter",s),t.off("dragleave",s),t.off("dragover",s),t.off("dragend",s),t.off("drop",s),p=!1)},n=function(r){return r?"object"!=typeof(c=e.$eval(r))?i():(t.attr("draggable",!0),d=c.beforeStart||angular.noop,o(),!0):i()},i=function(){return a(),t.removeAttr("draggable"),!1},r.$observe("ngDragDropConfig",n),e.$on("$destroy",i)}}}]).directive("ngDragDrop",[function(){return{restrict:"A",require:"^?ngDragDropConfig",link:function(e,t,r){var n,i,o;o=t[0],n=function(t){return i(),o.$$ngDragDropItem=t?e.$eval(t):null,!0},i=function(){return o.hasOwnProperty("$$ngDragDropItem")&&delete o.$$ngDragDropItem,!1},r.$observe("ngDragDrop",n),e.$on("$destroy",i)}}}]),angular.module("core.library.dragDrop").directive("motoDragWidget",[function(){var e=-12,t=8;return{restrict:"A",link:function(r,n,i){function o(){return d&&d.item||null}function a(r){var i=o();if(r&&i&&c){if("dragstart"==r.type){c.beforeStart(r,i,n),r.originalEvent.dataTransfer.effectAllowed="move",r.originalEvent.dataTransfer.dropEffect="move",n.get(0);try{r.originalEvent.dataTransfer.setData("text",n.html())}catch(e){}c.hasOwnProperty("box")?c.box instanceof Function?c.box.setDragImage(r):"object"==typeof c.box?r.originalEvent.dataTransfer.setDragImage&&r.originalEvent.dataTransfer.setDragImage(c.box,e,t):r.originalEvent.dataTransfer.setDragImage&&r.originalEvent.dataTransfer.setDragImage(n.context,e,t):r.originalEvent.dataTransfer.setDragImage&&r.originalEvent.dataTransfer.setDragImage(n.context,e,t)}return c.cssClass&&("dragenter"!=r.type&&"dragover"!=r.type||("string"==typeof c.cssClass?n.addClass(c.cssClass):c.cssClass instanceof Function&&c.cssClass.apply(c,[r.type,n,r])),"dragleave"!=r.type&&"drop"!=r.type||("string"==typeof c.cssClass?n.removeClass(c.cssClass):c.cssClass instanceof Function&&c.cssClass.apply(c,[r.type,n,r]))),angular.isFunction(c[r.type])?c[r.type](r,i,n):void 0}}function s(){p||(n.on("drag",a),n.on("dragstart",a),n.on("dragenter",a),n.on("dragleave",a),n.on("dragover",a),n.on("dragend",a),n.on("drop",a),p=!0)}function u(){p&&(n.off("drag",a),n.off("dragstart",a),n.off("dragenter",a),n.off("dragleave",a),n.off("dragover",a),n.off("dragend",a),n.off("drop",a),p=!1)}function l(){return u(),n.removeAttr("draggable"),!1}var c,d,p=!1;i.$observe("motoDragWidget",function(e){return e?(d=r.$eval(e),angular.isObject(d)&&angular.isObject(d.item)&&angular.isObject(d.callbacks)?(c=d.callbacks,n.attr("draggable",!0),c.beforeStart=angular.isFunction(c.beforeStart)?c.beforeStart:function(){},s(),!0):l()):l()}),r.$on("$destroy",l)}}}]),angular.module("core.library.editor").provider("core.library.editor.BlocksService",["coreLibraryUtilsProvider",function(e){function t(e,t){if(this._collection=t,e=angular.extend({},a,e||{}),angular.extend(this,e),this._category=t.getCategoryByName(this.category),angular.isArray(this.allowed))for(var r=0,n=this.allowed.length;r<n;r++)angular.isString(this.allowed[r].pageType)&&(this.allowed[r].pageType=[this.allowed[r].pageType]),angular.isString(this.allowed[r].sectionName)&&(this.allowed[r].sectionName=[this.allowed[r].sectionName]);if(this._meta={},this.previewUrl){this.previewUrl=app.config.getUrl(this.previewUrl);var i=this.previewUrl.split("/");this._meta.previewFileName=i.pop(),this._meta.previewFilePath=i.join("/")}}function r(){this.isLoaded=!1,this.items=[],this.categories=angular.copy(c),this.addCategory=function(e){var t;return!(!e||this.isCategoryExists(e.name))&&(t=$.extend(!0,{},s,e),this.categories.push(t),n.$broadcast("MotoEvent:BlocksService.CategoryAdded",t),t)},this.isCategoryExists=function(e){return this.categories.some(function(t){return t.name===e})},this.getCategoryByName=function(e){var t;return this.isCategoryExists(e)?this.categories.some(function(r){r.name===e&&(t=r)}):t=this.addCategory($.extend(!0,{},s,{name:e})),t},this.getCategories=function(){return this.categories},this.addBlock=function(r){var i,o;return i=this.getCategoryByName(r.category),o=new t(r,this),this.items.push(o),i.blocks.push(o),e.sortArrayByProperty(i.blocks,"created_at"),n.$broadcast("MotoEvent:BlocksService.BlockAdded",o),o},this.deleteBlock=function(e){var t;return(t=this.getCategoryByName(e.category)).blocks.every(function(r,n){return r.id!==e.id||(t.blocks.splice(n,1),!1)}),!0},this.getBlocksByCategory=function(e){return this.getCategoryByName(e).blocks},this.getBlocks=function(e){var t=o.defer(),e=e||!1;return u&&u.isLoaded&&!e?t.resolve(u):i.newService("BlocksService").createMethod("getList",{ignoreLoadingBar:!0})().then(function(e){e.items&&e.items.length&&e.items.forEach(function(e){u.addBlock(e)}),u.isLoaded=!0,n.$broadcast("MotoEvent:BlocksService.FilledFromServer"),t.resolve(u)}),t.promise},this.syncWithServer=function(){return this.clearCollectionData(),this.getBlocks(!0)},this.clearCollectionData=function(){return this.items=[],this.categories=angular.copy(c),this}}var n,i,o,a,s,u,l=this,c=[{name:"headers",label:"WIDGET.BLOCK.CATEGORY.HEADERS",order:5,blocks:[]},{name:"galleries",label:"WIDGET.BLOCK.CATEGORY.GALLERIES",order:10,blocks:[]},{name:"call_to_action",label:"WIDGET.BLOCK.CATEGORY.CALL_TO_ACTION",order:15,blocks:[]},{name:"general",label:"WIDGET.BLOCK.CATEGORY.GENERAL",order:20,blocks:[]},{name:"price_tables",label:"WIDGET.BLOCK.CATEGORY.PRICE_TABLES",order:25,blocks:[]},{name:"counters",label:"WIDGET.BLOCK.CATEGORY.COUNTERS",order:30,blocks:[]},{name:"teams",label:"WIDGET.BLOCK.CATEGORY.TEAMS",order:35,blocks:[]},{name:"partners_and_clients",label:"WIDGET.BLOCK.CATEGORY.PARTNERS_AND_CLIENTS",order:40,blocks:[]},{name:"testimonials",label:"WIDGET.BLOCK.CATEGORY.TESTIMONIALS",order:45,blocks:[]},{name:"contacts",label:"WIDGET.BLOCK.CATEGORY.CONTACTS",order:50,blocks:[]},{name:"footers",label:"WIDGET.BLOCK.CATEGORY.FOOTERS",order:55,blocks:[]},{name:"more",label:"WIDGET.BLOCK.CATEGORY.MORE",order:60,blocks:[]},{name:"user_blocks",label:"WIDGET.BLOCK.CATEGORY.USER_BLOCKS",order:100,blocks:[]}];a={id:"",previewUrl:"",category:"more",order:50,options:{templateUrl:""}},s={name:"",label:"",order:80,blocks:[]},t.prototype={_collection:null,_category:null,_meta:{},id:"",previewUrl:"",category:"more",allowed:!0,order:50,options:{templateUrl:""},getPreviewFileName:function(){return this._meta.previewFileName},getPreviewFilePath:function(){return this._meta.previewFilePath},getCategoryName:function(){return this.category},getCategory:function(){return this._category},isAllowToUse:function(e,t){if(t=t||null,!angular.isArray(this.allowed))return this.allowed;var r,n,i,o=!1,a=this.allowed;for(n=0,i=a.length;n<i&&(r=a[n],e&&r.pageType?(o=r.pageType.indexOf(e)>-1,t&&r.sectionName&&(o&=r.sectionName.indexOf(t)>-1)):t&&r.sectionName&&(o=r.sectionName.indexOf(t)>-1),!o);n++);return o},getAllowedSections:function(e){var t=[];if(!angular.isArray(this.allowed))return t;var r,n,i,o=this.allowed;for(n=0,i=o.length;n<i;n++)if(r=o[n],!e||angular.isUndefined(r.pageType)||-1!=r.pageType.indexOf(e)){if(!r.sectionName){t=[];break}t=t.concat(r.sectionName)}return t.length>0&&(t=t.filter(function(e,r){return t.indexOf(e)==r})),t}},u=new r,l.getBlocks=function(){return u.getBlocks()},l.syncWithServer=function(){return u.syncWithServer()},l.addCategory=function(e){return u.addCategory(e)},l.addBlock=function(e){return u.addBlock(e)},l.deleteBlock=function(e){return u.deleteBlock(e)},l.saveToTheme=function(e){var t=!e.id;return u.saveToTheme(e).then(function(e){return t&&(e=u.addBlock(e)),e})},l.deleteFromTheme=function(e){return u.deleteFromTheme(e).then(function(){l.deleteBlock(e)})},l.$get=["$rootScope","jsonrpc","$q",function(e,t,a){return n=e,i=t,o=a,r.prototype._Service=i.newService("BlocksService"),r.prototype.saveToTheme=r.prototype._Service.createMethod("saveToTheme"),r.prototype.deleteFromTheme=r.prototype._Service.createMethod("deleteFromTheme"),l}]}]),angular.module("core.library.editor.history").service("EditorHistoryManager",["coreLibraryUtils","$timeout","$q",function(e,t,r){function n(n){function u(){d.options.widgetId&&(p=d.options.widgetId),n.Widgets.checkAndScrollTo(p),g.isUndoInProcess()?v.push(d):m.push(d),t(function(){n.selectWidget(p),y=!1,b=!1,i.resolve(d),i=null,p=null,f=null,d=null})}var l,c,d,p,f,g=this,h={},m=[],v=[],y=!1,b=!1;this.getTransactionInProcess=function(){return d||null},this.isUndoOrRedoInProcess=function(){return this.isUndoInProcess()||this.isRedoInProcess()},this.isUndoInProcess=function(){return y},this.isRedoInProcess=function(){return b},this.clearUndoTransactions=function(){m.length=0},this.clearRedoTransactions=function(){v.length=0},this.startActionsTransaction=function(e,t){return d||this.isUndoOrRedoInProcess()?(d&&!this.isUndoOrRedoInProcess()&&console.warn('Transaction "'+e+'" was not started: "'+d.name+'" already in process.'),!1):(d={name:e,actions:[],options:t||{}},!0)},this.rejectActionsTransaction=function(e){d&&!this.isUndoOrRedoInProcess()&&d.name===e&&(d=null)},this.endActionsTransaction=function(e,t){if(d&&!this.isUndoOrRedoInProcess()&&d.name===e){if(d.actions.length){for(d.options=d.options||{},d.options=angular.extend(d.options,t),m.push(d);m.length>50;)m.shift();this.clearRedoTransactions(),l.$$phase||l.$apply()}return d=null,!0}return!1},this.runAction=function(e,t,r,n){e._callInterceptor(e.INTERCEPTOR__UNDO_REDO_ACTION_BEFORE,t,r),a[t](e,r,n)},this._executeTransactionActions=function(){var e,r,i=g.isUndoInProcess();try{e=i?f.pop():f.shift(),r=i&&o[e.name]?o[e.name]:e.name,angular.isDefined(e.data.id)&&(p=e.data.id),g.runAction(n,r,e.data,function(){f.length?t(g._executeTransactionActions):u()})}catch(e){console.error(e),u()}},this._executeTransaction=function(e){var t,o;if(i=r.defer(),this.isUndoOrRedoInProcess())return i.reject(),i.promise;if("undo"===e){if(!m.length)return;y=!0,t=(d=m.pop()).actions.length-1}else if("redo"===e){if(!v.length)return;b=!0,d=v.pop(),t=0}for(f=d.actions,d.actions=[],o=0;o<f.length;o++)d.actions.push(f[o]);return n.Widgets.checkAndScrollTo(d.actions[t].data.id,this._executeTransactionActions),i.promise},this.addAction=function(e){!d||this.isUndoOrRedoInProcess()||s[e.name]||d.actions.push(e)},this.lockAction=function(e){s[e]=!0},this.unlockAction=function(e){delete s[e]},this.undo=function(){return this._executeTransaction("undo")},this.redo=function(){return this._executeTransaction("redo")},this.getUndoTransactions=function(){return m},this.getRedoTransactions=function(){return v},(l=n.getScope()).$on("NEW EVENT: Insert widget after",function(e,t){g.addAction({name:"createWidget",data:{id:t.getId()}})}),l.$on("NEW EVENT: Widget will be removed",function(e,t){c=t.exportForHistory()}),l.$on("NEW EVENT: Widget was removed",function(e,t){c&&c.id===t.getId()&&(g.addAction({name:"removeWidget",data:c}),c=null)}),l.$on("NEW EVENT: Widget properties were changed",function(t,r,n){var i,o,a,s,u,l,c;if(!g.isUndoOrRedoInProcess()&&r&&r.properties&&n){u=e.objectDiffQuick(r.properties,n,1),(i=m[m.length-1])&&(s=i.actions[i.actions.length-1]),a=(o=s&&"SetProperties"===i.name&&s.data.id===r.getId()&&!v.length&&!s.data.redoProperties)?s.data.undoProperties:{};for(l in u)u.hasOwnProperty(l)&&!a.hasOwnProperty(l)&&(a[l]=angular.copy(n[l]));Object.getOwnPropertyNames(a).length&&(o?s.data.undoProperties=a:(d||(c=g.startActionsTransaction("SetProperties")),g.addAction({name:"setProperties",data:{id:r.getId(),undoProperties:a}}),c&&g.endActionsTransaction("SetProperties")))}}),l.$on("NEW EVENT: Move widget before",function(e,t){var r=t.getLocationInEditor();h[t.getId()]={undoTargetWidgetId:r.parentWidgetId,undoIndexInContainer:r.indexInContainer}}),l.$on("NEW EVENT: Move widget after",function(e,t){var r=t.getLocationInEditor(),n=t.getId(),i=h[n];!i||r.parentWidgetId===i.undoTargetWidgetId&&r.indexInContainer===i.undoIndexInContainer||(i.id=n,g.addAction({name:"moveWidget",data:i})),delete h[n]}),l.$on("NEW EVENT: Editor self destroyed",function(){g.clearUndoTransactions(),g.clearRedoTransactions()})}var i,o={},a={},s={};return this.registerAction=function(e){a[e.name]=e.run,e.inverseName&&(o[e.name]=e.inverseName)},this.create=function(e){return new n(e)},this}]),angular.module("core.library.editor").provider("core.library.editor.PresetsService",["motoUI.MenuServiceProvider","motoFeaturesProvider","coreLibraryConfigProvider",function(e,t,r){function n(r){var n;this.name=r.name,this.order=r.order||100,angular.isDefined(r.enabled)?this.enabled=r.enabled:(n="theme_presets_"+this.name.replace(/\./g,"-"),this.enabled=!t.isExist(n)||t.isExist(n)&&t.isEnabled(n)),this.icons=r.icons||{},this.category=r.category||"more",this.stateParam=r.stateParam||this.name,this.base=r.base||null,this.label=r.label||"EDITOR.WIDGETS."+this.name.toUpperCase()+".LABEL",this.template=r.template||{path:"@websiteWidgets/"+this.name+"/templates/default.twig.css",engine:"nunjucks"},this.checkPresetControls=!angular.isDefined(r.checkPresetControls)||r.checkPresetControls,this.enabled&&!this.base&&e.getMenu("design_widgets_menu").addItem({label:this.label,state:"app.design.widgets.presets({widget: '"+this.stateParam+"'})",indicate:!1,priority:this.order,itemId:this.name,hidden:!!angular.isDefined(r.hidden)&&r.hidden,icon:this.icons.medium})}var i=[],o=this;return this.addWidget=function(e){return!t.isDisabled("theme_presets")&&(i.push(new n(e)),sortArrayByProperty(i,"order"),!0)},o.getWidgets=function(){return i.filter(function(e){return e.enabled})},o.getWidget=function(e){var t;for(t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null},this.getWidgetByStateParam=function(e){var t;for(t=0;t<i.length;t++)if(i[t].stateParam===e)return i[t];return null},o.getPresetsWidget=function(e){var t;if(!e)return null;for(t=0;t<i.length;t++)if(i[t].name===e)return i[t].base||i[t].name;return null},o.getPresetControls=function(e,t){var n;return e?(n=r.get("settings.website.theme_presets",{}),angular.isString(n)&&(n=angular.fromJson(n||{})),n&&n[e]?void 0===t?n[e]:n[e][t]||null:null):null},{addWidget:o.addWidget,getWidget:o.getWidget,getWidgets:o.getWidgets,$get:["jsonrpc",function(e){var t=e.newService("PresetsService");return o.getList=t.createMethod("getList"),o.save=t.createMethod("save"),o}]}}]).provider("core.library.editor.PresetsModel",[function(){var e;e=function(e,t){var r=this;t=t||{},r.id=t.id||"",r.name=t.name||"",r.widget_name=t.widget_name||"",r.class_name=t.class_name,r.is_system=parseInt(t.is_system),r.is_responsive=t.is_responsive||0,r.template=t.template||"",r.properties=angular.fromJson(t.properties),r.created=t.created||null,r.modified=t.modified||null},this.$get=["core.library.editor.PresetsService",function(t){var r=this;return Model.register("Presets",{proxy:r.proxy={service:t},record:e}),Model("Presets").load(!1)}]}]),angular.module("core.library.editor").provider("core.library.editor.WidgetsService",["motoFeaturesProvider","coreLibraryInterceptorsProvider",function(e,t){function r(e){var t,r={small:"",medium:"",large:""};for(t in r)e.hasOwnProperty(t)&&e[t]&&(r[t]=e[t].trim());return r}function n(t){var n;t=t||{},this.name=t.name||null,this.label=t.label||"EDITOR.WIDGETS."+this.name.toUpperCase()+".LABEL",this.category=t.category||"more",this.order=t.order||100,angular.isDefined(t.enabled)?this.enabled=t.enabled:(n="theme_widget_"+t.name.replace(/\./g,"-"),this.enabled=!e.isExist(n)||e.isExist(n)&&e.isEnabled(n)),this.icons={},this.icons=angular.isObject(t.icons)?r(t.icons):{},this.options=t.options||{},t.allowed&&(this.allowed=t.allowed)}function i(e){var t=null;return angular.forEach(a,function(r){e==r.name&&(t=r)}),t}var o=this,a=[{name:"structure",label:"WIDGET.COMMON.CATEGORY.STRUCTURE",order:5,widgets:[]},{name:"basic",label:"WIDGET.COMMON.CATEGORY.BASIC",order:10,widgets:[]},{name:"galleries",label:"WIDGET.COMMON.CATEGORY.GALLERIES",order:15,widgets:[]},{name:"social",label:"WIDGET.COMMON.CATEGORY.SOCIAL",order:20,widgets:[]},{name:"media",label:"WIDGET.COMMON.CATEGORY.MEDIA",order:23,widgets:[]},{name:"blog",label:"WIDGET.COMMON.CATEGORY.BLOG",order:25,widgets:[]},{name:"more",label:"WIDGET.COMMON.CATEGORY.MORE",order:30,widgets:[]}],s=t.createSimpleInterceptor();return o.addCategory=function(e,t,r){return"string"==typeof e&&(i(e)||(a.push({name:e,label:"string"!=typeof t?e.toUpperCase():t,order:r||100,widgets:[]}),sortArrayByProperty(a,"order")),!0)},o.addWidget=function(e){var t;return s.execute("widget.adding",e),!(void 0===e||!e.name)&&(!!(t=i(e.category))&&(t.widgets.push(new n(e)),sortArrayByProperty(t.widgets,"order"),s.execute("widget.added",e),!0))},o.getWidgetsByOptions=function(e,t,r){var n,a=[];return"string"!=typeof e?null:(n=i(e))&&t&&t.type?(n.widgets.forIn(function(e,n){o.isWidgetAllowedToUse(n.name,t,r)&&a.push(n)}),a):null},o.getCategories=function(){return a},o.getWidget=function(e){var t,r;for(t=0;t<a.length;t++)for(r=0;r<a[t].widgets.length;r++)if(e===a[t].widgets[r].name)return a[t].widgets[r];return!1},o.isWidgetAllowedToUse=function(e,t,r){var n=o.getWidget(e),i=!1;return"popup"===t.type?!!n.hasOwnProperty("allowed")&&(!!angular.isFunction(n.allowed)&&n.allowed(t,r)):(n.hasOwnProperty("allowed")?angular.isString(n.allowed)?i=n.allowed===t.type:angular.isArray(n.allowed)?i=n.allowed.indexOf(t.type)>=0:angular.isFunction(n.allowed)&&(i=n.allowed(t,r)):i=!0,i)},{addInterceptor:function(e,t){return s.addInterceptor(t,e)},addCategory:o.addCategory,addWidget:o.addWidget,isWidgetAllowedToUse:o.isWidgetAllowedToUse,getWidget:o.getWidget,$get:[function(){return o}]}}]),angular.module("core.library.Features",["core.library.interceptors"]).provider("motoFeatures",["coreLibraryInterceptorsProvider",function(e){function t(e,t){var r;return!!e&&(r=l[e],t&&(r=c.execute("isEnabled: "+e,r,t)),Boolean(r))}function r(e){return!t(e)}function n(e){return l.hasOwnProperty(e)}function i(e,t){return!l[e]&&t?t:l[e]}function o(e,t){var r;if(t=t||!0,angular.isString(e))l[e]=t;else if(angular.isArray(e))for(r=0;r<e.length;r++)o(e[r],t);else if(angular.isObject(e))for(r in e)e.hasOwnProperty(r)&&o(r,e[r])}function a(e){var t;if(angular.isString(e))l[e]&&delete l[e];else if(angular.isArray(e))for(t=0;t<e.length;t++)a(e[t]);else if(angular.isObject(e))for(t in e)e.hasOwnProperty(t)&&a(t)}function s(){return l}var u={},l={allow_code_injection:!0,engine_dashboard:!0,theme_widget_social_links_extended:!0},c=e.createSimpleInterceptor();this.isEnabled=t,this.isDisabled=r,this.isExist=n,this.getValue=i,this.enable=o,this.disable=a,this.getList=s,this.setList=function(e){l=e},this.addList=function(e){angular.extend(l,e)},this.addInterceptor=function(e,t){return c.addInterceptor(t,e)},u.isEnabled=t,u.isDisabled=r,u.isExist=n,u.getValue=i,u.getList=s,this.$get=[function(){return u}]}]),angular.module("core.library.history",[]).service("simpleHistory",[function(){var e=this,t=null,r=null;e.init=function(e){t=e,r=angular.copy(e)},e.isChanged=function(){return!angular.equals(JSON.stringify(t),JSON.stringify(r))},e.reset=function(e){angular.extend(e,angular.copy(r)),t=e},e.clear=function(){t=null,r=null},e.createNew=function(){return new function(){var e,t;this.save=function(r){e=null,r&&(e=angular.copy(r),t=r)},this.revert=function(t){e&&t&&(angular.extend(t,e),t.properties=angular.copy(e.properties))},this.clear=function(){e=null},this.isChanged=function(){return!(!e||!t)&&!angular.equals(e,t)},this.getPrev=function(){return t},this.getUndo=function(){return e}}}}]),angular.module("core.library.HttpRequestQueue",["ng"]).provider("coreLibraryHttpRequestQueue",["$httpProvider",function(e){function t(e,t){var r=this;this.request=e,this.queue=t,e[d+"CompleteQueuedRequest"]=function(){return r.requestCompleted()}}function r(){this.items=[],this.stats=this.stats}function n(e){var t,r,n,i=!1;if(!e||p.concurrentConnections<1||!c.length||!s||!a||e.ignoreHttpQueued)return!1;for(r=0,n=c.length;r<n;r++)if(t=c[r],angular.isFunction(t))try{if(!0===t(e)){i=!0;break}}catch(e){}return i}function i(e){try{e&&e.config&&angular.isFunction(e.config[d+"CompleteQueuedRequest"])&&e.config[d+"CompleteQueuedRequest"]()}catch(t){p.debug&&(console.warn("ERROR on taskCompletedByResponse"),console.warn("error",t),console.warn("response",e))}}var o,a=!1,s=!1,u=this,l={locked:!1,items:[]},c=[],d="__RequestQueue__",p={concurrentConnections:0,debug:!1};u.isConnected=function(){return a},u.enable=function(){s=!0,a||(e.interceptors.push(o),a=!0)},u.disable=function(){s=!1},u.getStatistics=function(){return angular.copy(l.stats)},u.setConcurrentConnections=function(e){(e=parseInt(e))>0||(e=0),p.concurrentConnections=e},u.addRequestValidator=function(e){return!!angular.isFunction(e)&&(c.push(e),!0)},t.prototype.inProgress=!1,t.prototype.isCompleted=!1,t.prototype.request=null,t.prototype.deferred=null,t.prototype.queue=null,t.prototype.destroy=function(){delete this.request,delete this.deferred,delete this.queue},t.prototype.setDeferred=function(e){this.deferred=e},t.prototype.requestCompleted=function(){return!this.isCompleted&&(this.isCompleted=!0,this.inProgress=!1,this.queue.taskCompleted(this),!0)},t.prototype.resolveRequest=function(){if(this.inProgress||this.isCompleted)return!1;this.inProgress=!0;try{this.deferred.resolve(this.request)}catch(e){p.debug&&console.error("Error on resolve request",e)}return!0},r.prototype.locked=!1,r.prototype.items=[],r.prototype.stats={work:0,done:0,total:0},r.prototype.addRequest=function(e,r){var n,i=r.defer();return(n=new t(e,this)).setDeferred(i),this.items.push(n)<=p.concurrentConnections&&this.dispatchFreeTasks(),i.promise},r.prototype.taskCompleted=function(e){this.stats.work--,this.stats.done++,this.dispatchFreeTasks()},r.prototype.dispatchFreeTasks=function(){if(this.locked)return!1;this.locked=!0;var e,t,r=p.concurrentConnections,n=[],i=0;for(e=0,t=this.items.length;e<t&&!(i>=r||n.length>=r);e++)this.items[e].isCompleted?(this.items[e].destroy(),this.items.splice(e,1),e--,t--):this.items[e].inProgress?i++:(i++,this.items[e].resolveRequest(),this.stats.work++);this.locked=!1,this.stats.total=this.items.length},l=new r,o=["$q",function(e){return{request:function(t){return n(t)?l.addRequest(t,e):t},response:function(e){return i(e),e},responseError:function(t){return i(t),e.reject(t)}}}],this.$get=[function(){return{getStatistics:u.getStatistics}}]}]),angular.module("core.library.integration",[]).provider("coreLibraryIntegration",[function(){function e(e,t){return"type"===e&&(t=t.toLowerCase().trim()),t}function t(e){this._data={},this.setFromData(e)}function r(){this._items=[],t.apply(this,arguments)}function n(t){t=e("type",t);var n=null;return i[t]?n=i[t]:(n=new r({type:t}),i[n.getType()]=n),n}var i={},o={},a=!1;t.prototype._data={},t.prototype._nameToMethod=function(e){var t=e.trim();return t=t.replace(/([_])/g," "),t=t.replace(/^([a-z])|\s+([a-z])/g,function(e){return e.toUpperCase()}),t=t.replace(/(\s)/g,"")},t.prototype.set=function(e,t){var r="set"+this._nameToMethod(e);return angular.isFunction(this[r])?this[r](t):(this._data[e]=t,this)},t.prototype.get=function(e,t){if(angular.isUndefined(e))return this._data;var r="get"+this._nameToMethod(e);return angular.isFunction(this[r])?this[r](t):angular.isUndefined(this._data[e])?t:this._data[e]},t.prototype.setFromData=function(e){a&&console.log("IntegrationItem.setFromData",e);for(var t in e)e.hasOwnProperty(t)&&this.set(t,e[t]);return this},r.prototype=new t,r.prototype.constructor=r,r.prototype.setType=function(t){return this._data.type=e("type",t),this},r.prototype.getType=function(){return this._data.type},r.prototype.setItems=function(e){var r,n;for(n in e)e.hasOwnProperty(n)&&(r=new t(e[n]),this._items.push(r));return this},r.prototype.first=function(){var e;return this._items.length>0?e=this._items[0]:(e=new t,this._items.push(e)),e},o.addCollections=this.addCollections=function(e){a&&console.log("setList",e.length,e);var t,n,o;for(n=0,o=e.length;n<o;n++)a&&console.log("new IntegrationCollection",e[n]),t=new r(e[n]),a&&console.log("IntegrationCollection = ",t),i[t.getType()]=t},o.get=this.get=n,o.first=this.first=function(e){return n(e).first()},window.$service=o,this.$get=[function(){return o}]}]),angular.module("core.library.interceptors").provider("coreLibraryInterceptors",[function(){function e(e){this.createInterceptor=function(t){return e.createInterceptor(t)},this.createSimpleInterceptor=function(){return e.createSimpleInterceptor()},this.createWildCartInterceptor=function(){return e.createWildCartInterceptor()}}function t(){}function r(){this._handlers={},this._options={}}function n(){r.apply(this,arguments)}function i(){r.apply(this,arguments)}var o,a={defaultConstructor:"SimpleInterceptor",showError:!1};return o=new t,t.prototype._interceptorConstructors={},t.prototype.setOption=function(e,t){return!(!angular.isString(e)||e.trim().length<1)&&(a[e]=t,!0)},t.prototype.getOption=function(e,t){return angular.isDefined(a[e])?a[e]:t},t.prototype.setEnvironmentStage=function(e){"development"===e&&this.setOption("showError",!0)},t.prototype.addConstructor=function(e,t){return!angular.isString(e)||e.trim().length<1?(this.isShowError()&&console.error("InterceptorProvider.addConstructor : bad interceptor name. Must be a string and not empty : ",e),!1):angular.isFunction(t)?void(this._interceptorConstructors[e]=t):(this.isShowError()&&console.error("InterceptorProvider.addConstructor : bad interceptor constructor. Must be a function : ",t),!1)},t.prototype.getConstructor=function(e){return this.hasConstructor(e)?this._interceptorConstructors[e]:null},t.prototype.hasConstructor=function(e){return!!this._interceptorConstructors[e]},t.prototype.createInterceptor=function(e){var t;return angular.isUndefined(e)&&(e=this.getOption("defaultConstructor")),t=this.getConstructor(e),angular.isFunction(t)?new t:null},t.prototype.createSimpleInterceptor=function(){return this.createInterceptor("SimpleInterceptor")},t.prototype.createWildCartInterceptor=function(){return this.createInterceptor("WildCartInterceptor")},t.prototype.$get=function(){return new e(this)},r.prototype._handlers={},r.prototype._options={},r.prototype.setOption=function(e,t){return!(!angular.isString(e)||e.trim().length<1)&&(this._options[e]=t,!0)},r.prototype.getOption=function(e,t){return angular.isDefined(this._options[e])?this._options[e]:o.getOption(e,t)},r.prototype.isShowError=function(){return this.getOption("showError",!1)},r.prototype.addInterceptor=function(e,t){return angular.isFunction(e)?!angular.isString(t)||t.trim().length<1?(this.isShowError()&&console.error("SimpleInterceptor.addInterceptor : bad interceptor name. Must be a string and not empty : ",t),!1):(t=t.trim(),this._handlers[t]=this._handlers[t]||[],this._handlers[t].push(e),!0):(this.isShowError()&&console.error("SimpleInterceptor.addInterceptor : bad interceptor handler. Must be a function : ",e),!1)},r.prototype.getHandlers=function(e){return this._handlers[e]||[]},r.prototype.execute=function(e,t,r){var n,i,o,a,s,u={name:e};if(n=this.getHandlers(e),!angular.isArray(n)||!n.length>0)return t;for(a=0,s=n.length;a<s;a++)try{i=n[a],angular.isFunction(i)&&(o=i(u,t,r),angular.isDefined(o)&&null!==o&&(t=o))}catch(t){this.isShowError()&&(console.error("SimpleInterceptor.execute : Error catched"),console.error("\tInterceptor name :",e),console.error("\tInterceptor handler :",i),console.error("\tInterceptor error :",t))}return t},n.prototype=Object.create(r.prototype),n.prototype.constructor=n,i.prototype=Object.create(r.prototype),i.prototype.constructor=i,i.prototype.addInterceptor=function(e,t){return angular.isUndefined(t)&&(t="*"),r.prototype.addInterceptor.call(this,e,t)},i.prototype.getHandlers=function(e){var t;return t=r.prototype.getHandlers.call(this,e),angular.isArray(this._handlers["*"])&&(t=t.concat(this._handlers["*"])),t},i.prototype.addHandler=function(e,t){return console.log(e),console.log(t),function(){}},o.addConstructor("SimpleInterceptor",r),o.addConstructor("WildCartInterceptor",i),o}]),angular.module("core.library.jsonrpc",["ngFileUpload","core.library.config"]).provider("jsonrpc",["coreLibraryConfigProvider",function(e){function t(){return e.isDevelopment()}function r(e,t){return e.sort(function(e,r){return e[t]<r[t]?-1:e[t]>r[t]?1:0})}function n(e,t){var r={injected:!1};return angular.isString(e)||angular.isFunction(e)||angular.isArray(e)?(angular.isObject(t)||(t={}),r.interceptor=e,r.priority=angular.isNumber(t.priority)?t.priority:100,r.methods=angular.isDefined(t.methods)?t.methods:"*.*",angular.isString(r.methods)&&(r.methods=[r.methods]),s.push(r),!0):(a&&console.error("Not valid interceptor",typeof e,e),!1)}function i(){return l+++""}var o=this,a=!1,s=[],u=this.defaults={},l=0;o.addInterceptor=function(e,t){return n(e,t)},u.basePath="/rpc",this.$get=["$http","$q","$injector","Upload",function(e,n,a,l){function c(e){var t,r,n,i,o,u=e.split("."),l=u.pop(),c=u.join("."),d=[],p=s.length;for(o=0;o<p;o++)r=!1,t=s[o].methods,angular.isFunction(t)?r=t({service:c,method:l}):(r|=t.indexOf("*")>-1,r|=t.indexOf("*.*")>-1,r|=t.indexOf(c+".*")>-1,r|=t.indexOf("*."+l)>-1,r|=t.indexOf(c+"."+l)>-1),r&&(i=s[o].injected,n=s[o].interceptor,i||(n=angular.isString(n)?a.get(n):a.invoke(n),s[o].injected=!0,s[o].interceptor=n),d.push(n));return d}function d(e,t,r){var n,i;if("request"===r)for(n=t.length-1;n>=0;n--)(t[n].request||t[n].requestError)&&(e=e.then(t[n].request,t[n].requestError));if("response"===r)for(n=0,i=t.length;n<i;n++)(t[n].response||t[n].responseError)&&(e=e.then(t[n].response,t[n].responseError));return e}function p(t,r,o){var a,s,c,d,p=i(),f={jsonrpc:"2.0",method:t.method,id:p},g=n.defer(),h=g.promise;u.BeforeRequest&&u.BeforeRequest(f,t,r),angular.isDefined(t.data)&&(f.params=t.data);var m=[];angular.forEach(e.defaults.transformResponse,function(e){m.push(e)}),m.push(function(e){return e&&e.id===p?e:null});var v=(r=r||{}).transformResponse;return angular.isArray(v)?[].push.apply(m,v):angular.isFunction(v)&&m.push(v),r.transformResponse=m,d=t.path||u.basePath,a=r,a.headers=a.headers||{},a.headers["X-Requested-With"]=a.headers["X-Requested-With"]||"XMLHttpRequest",a.method="POST",a.url=d,a.data=f,o&&(a.file=o),s=n.when(a),s=s.then(function(r){var i=n.defer();return o?(t.progress&&(c=t.progress,delete t.progress),s=l.upload(r).progress(function(e){c instanceof Function&&c.call(c,e)})):s=e(r),s.then(i.resolve,i.reject),i.promise}),s=s.then(function(e){var t=e.data;e.status,e.headers,e.config;return null===t?(u.ErrorRequest&&u.ErrorRequest(h,null),g.reject(null)):t&&t.hasOwnProperty("error")?(u.ErrorRequest&&u.ErrorRequest(h,t.error),g.reject(t.error)):t&&t.hasOwnProperty("result")?(u.SuccessRequest&&u.SuccessRequest(h,t.result),g.resolve(t.result)):(u.ErrorRequest&&u.ErrorRequest(h,t),g.reject(t)),e},function(e){return u.ErrorRequest&&u.ErrorRequest(h,e.data),g.reject({code:e.status,message:"COMMON.MESSAGES.LOAD_DATA_FROM_SERVER_ERROR",type:"NETWORK",httpError:e}),e}),g.promise}function f(e,t){this.serviceName=e,this.path=t}return s=r(s,"priority"),p.request=function(e,t,r,n){return arguments.length<4&&(n=r,r=t,t=e,e=null),p({path:e,method:t,data:r},n)},p.setBasePath=function(e){return o.setBasePath(e)},p.getBasePath=function(){return o.getBasePath()},p.setBeforeRequest=function(e){return o.setBeforeRequest(e)},p.setEndSuccessRequest=function(e){return o.setEndSuccessRequest(e)},p.setEndErrorRequest=function(e){return o.setEndErrorRequest(e)},f.prototype.createMethod=function(e,r){var i=this.path,o=this.serviceName+"."+e,a=function(e){var a,s=c(o),u={path:i,method:o,params:e,config:angular.copy(r)},l=!!s.length;return a=n.when(u),l&&(a=d(a,s,"request")),a=a.then(function(e){var t=n.defer();return a=p.request(e.path,e.method,e.params,e.config),l&&(a=a.then(function(t){return n.resolve({data:t,request:e})},function(t){return n.reject({error:t,request:e})}),a=d(a,s,"response"),a=a.then(function(e){return n.resolve(e.data?e.data:e)},function(e){return n.reject(e.error?e.error:e)})),a.then(t.resolve,t.reject),t.promise},function(e){return n.reject(e)}),a.success=function(e){return t()&&console.warn('Some code call deprecated method "success" on ',o),a.then(e),this},a.error=function(e){return t()&&console.warn('Some code call deprecated method "error" on ',o),a.then(null,e),this},a.stopPropagation=function(){t()&&console.warn('Some code call deprecated method "stopPropagation" on ',o)},a};return a.__jsonRpcMethod=o,a},f.prototype.createUploadMethod=function(e,r){var n=this.path,i=this.serviceName+"."+e;return function(e,o,a){var s;if(!e)throw"Property file not found";return s=p({path:n,method:i,data:o,progress:a},r,e),s.success=function(e){return t()&&console.warn('Some code call deprecated method "success" on ',i),s.then(e),this},s.error=function(e){return t()&&console.warn('Some code call deprecated method "error" on ',i),s.then(null,e),this},s}},p.newService=function(e,t){return new f(e,t)},p.createBatch=function(t,r){function o(){}return o.prototype={_requests:[],_callbacks:{},add:function(e,t){var r={jsonrpc:"2.0",id:i()},o=n.defer(),a=!1,s=o.promise,u={success:function(){},error:function(){}};return angular.isFunction(e)&&(e=e.__jsonRpcMethod),!!e&&(r.method=e,angular.isDefined(t)&&(r.params=t),s.success=function(e){return u.success=e,this},s.error=function(e){return u.error=e,this},s.then(function(){a||u.success.apply(null,arguments)},function(){a||u.error.apply(null,arguments)}),s.stopPropagation=function(){a=!0},this._requests.push(r),this._callbacks[r.id]=o,s)},isEmpty:function(){return!this._requests.length},doRequest:function(){function t(e){var t=r._callbacks[e.id];return!!t&&(null===e?t.reject(null):e&&e.hasOwnProperty("error")?t.reject(e.error):e&&e.hasOwnProperty("result")?t.resolve(e.result):t.reject(e),!0)}var r=this,i=n.defer(),o=i.promise,a=!1,s={success:function(){},error:function(){}},l={method:"POST",url:u.basePath,headers:{"X-Requested-With":"XMLHttpRequest"},data:this._requests};return o.success=function(e){return s.success=e,this},o.error=function(e){return s.error=e,this},o.then(function(){a||s.success.apply(null,arguments)},function(){a||s.error.apply(null,arguments)}),o.stopPropagation=function(){a=!0},this.isEmpty()?(i.resolve(),o):(e(l).success(function(e,r,n,o){for(var a=0,s=e.length;a<s;a++)t(e[a]);i.resolve(e)}).error(function(e){for(var r=0,n=e.length;r<n;r++)t(e[r]);i.reject(e)}).finally(function(){r._requests=[],r._callbacks={}}),o)}},new o},p}],o.setBasePath=function(e){return this.defaults.basePath=e,this},o.getBasePath=function(){return this.defaults.basePath},o.setBeforeRequest=function(e){return this.defaults.BeforeRequest=e,this},o.setEndSuccessRequest=function(e){return this.defaults.SuccessRequest=e,this},o.setEndErrorRequest=function(e){return this.defaults.ErrorRequest=e,this}}]),angular.module("core.library.languages",["core.library.utils","core.library.config"]).provider("coreLibraryLanguages",["coreLibraryUtilsProvider","coreLibraryConfigProvider",function(e,t){this.getProfileCode=function(){return this.getProfileLocale().substring(0,2)}.bind(this),this.getWebsiteCode=function(){return this.getWebsiteLocale().substring(0,2)}.bind(this),this.getProfileLocale=function(){return e.getObjectValueByPath(window,"app.user.language_locale","en_US")},this.getWebsiteLocale=function(){return t.get("settings.website.language_locale","en_US")},this.$get=[function(){return this}.bind(this)]}]),angular.module("core.library.LivePreview",["core.library.CssGenerator","core.library.utils","core.library.messenger","core.library.scriptsInjector"]).provider("coreLibraryLivePreview",[function(){this.$get=["$rootScope","coreLibraryCssGenerator","coreLibraryUtils","$q","MotoDevicesConstants","coreLibraryWidget","ScriptsInjector",function(e,t,r,n,i,o,a){function s(){return document.getElementById("id_live_preview")||null}function u(){var e=this;this._em=null,this._url=null,this._device="desktop",this.isLoad=!1,e._load=function(){e._inject()},e.processCallbacks=function(){o.afterLivePreviewReady.forIn(function(t,r){r(e.window)}),e.window.$(e.window).on("widthChanged",function(){o.afterWidthChanged.forIn(function(t,r){r(e.window)})}),e.window.$("body").delegate("a","click",function(e){e.preventDefault()}),e.updateFrame(),e.window.$(e.window).trigger("resize")},(e._domFrame=s())&&(window.livePreviewLoaded=e._load,e.setDevice(e.getOption("defaultDevice","desktop")),e.$(function(){e.window.$&&e.processCallbacks(),e.ScriptsInjector=a.create(e.window)})),this.insertCssInStyleTag=function(t,r){var n,i,o;if(!e.document)return null;o=r?d:c,(n=e.document.getElementById(o))||((n=e.document.createElement("style")).setAttribute("id",o),r&&(i=e.$("#"+c)).length?i.after(n):e.document.body.appendChild(n)),n.innerHTML=t}}var l={desktop:function(){return i.SIZE.DESKTOP},tablet:function(){return i.SIZE.TABLET},"mobile-h":function(){return i.SIZE["MOBILE-H"]},"mobile-v":function(){return i.SIZE["MOBILE-V"]}},c="live_preview_css",d="temp_css";return u.prototype={_em:null,_url:null,_domFrame:null,_load:null,_device:null,isLoad:!1,_options:{defaultStyleId:"moto-website-style",deviceCssClassPrefix:"moto-preview-device_",defaultDevice:"desktop",scrollBarWidth:null,backgroundClassMask:/^moto-background(_[0-9]+)*/},window:null,document:null,_queue:{ready:[]},setOption:function(e,t){return this._options[e]=t,this},getOption:function(e,t){return this._options[e]||t||null},$:function(e,t){return angular.isFunction(e)&&this._queue.ready.push(e),this.document?e?(t=t||this.document,$(e,t)):$(this.document):null},_inject:function(){var e;if(this._domFrame||this.isLoad){if(this.window=this._domFrame.contentWindow,this.document=this.window.document,this.isLoad=!0,this._queue.ready.length)for(e=0;e<this._queue.ready.length;e++)$(this._queue.ready[e],this.document);this._em&&this._em.trigger("LivePreview.load")}},appendStyleSheet:function(e,t){var n=this,i={tag:"link",url:e,target:"body",attributes:{id:null,href:e,rel:"stylesheet"}};return angular.isObject(t)&&(i=r.deepExtend(i,t)),n.appendAssets(i)},appendJavaScript:function(e,t){var n=this,i={tag:"script",url:e,target:"head",attributes:{id:null,src:e}};return angular.isObject(t)&&(i=r.deepExtend(i,t)),n.appendAssets(i)},appendAssets:function(e){var t,r,n=this,i=n.document;return i?(e.attributes.id||(e.attributes.id=e.url),(r=i.getElementById(e.attributes.id))||(t=e.target||"head",t=i.getElementsByTagName(t)[0],r=i.createElement(e.tag),angular.extend(r,e.attributes),t.appendChild(r)),n):null},disableDefaultCss:function(){var e,t=this.document;return t?((e=t.getElementById(this.getOption("defaultStyleId")))&&(e.disabled="disabled"),this):null},enableDefaultCss:function(){var e,t=this.document;return t?((e=t.getElementById(this.getOption("defaultStyleId")))&&(e.disabled=""),this):null},reloadDefaultCss:function(){var e,t=this,r=t.document;if(!r)return null;(e=r.getElementById(t.getOption("defaultStyleId")))&&($(e).data("url")||$(e).data("url",e.href),e.href=$(e).data("url")+"?_t="+Date.now(),t.enableDefaultCss())},destroy:function(){this._domFrame=null,this._em=null,this._queue.ready=[],this.window=null,this.document=null,this.ScriptsInjector&&this.ScriptsInjector.reset()},setUrl:function(e){var t,r;(this._url=e)&&this._domFrame&&((r=this.$("body"))&&r.addClass("moto-preview-overlay"),this.isLoad=!1,this.window=null,this.document=null,this.ScriptsInjector&&this.ScriptsInjector.reset(),(t=s())&&t.contentWindow?t.contentWindow.location.replace(this._url):this._domFrame.src=this._url)},reload:function(){var e=this,t=s();t&&t.contentWindow?t.contentWindow.location.replace(e._url):$("#id_live_preview").attr("src",function(e,t){return t})},setSize:function(e){var t=this;return e&&t._domFrame&&(e.width===l.desktop()?(t._domFrame.style.width="100%",t._domFrame.style["min-width"]=l.desktop()+t.getScrollBarWidth()+"px"):(t._domFrame.style.width=e.width+t.getScrollBarWidth()+"px",t._domFrame.style["min-width"]="0")),t},getScrollBarWidth:function(){var e=this;if(null==e._options.scrollBarWidth){var t=document.createElement("p");t.style.width="100%",t.style.height="200px";var r=document.createElement("div");r.style.position="absolute",r.style.top="0px",r.style.left="0px",r.style.visibility="hidden",r.style.width="200px",r.style.height="150px",r.style.overflow="hidden",r.appendChild(t),document.body.appendChild(r);var n=t.offsetWidth;r.style.overflow="scroll";var i=t.offsetWidth;n==i&&(i=r.clientWidth),document.body.removeChild(r),e._options.scrollBarWidth=n-i}return e._options.scrollBarWidth},setDevice:function(t){var r,n=this;return 750,t&&l.hasOwnProperty(t)&&(n.setSize({width:l[t]()}),r=$(n._domFrame).find("body"),n._device&&r.removeClass(n.getOption("deviceCssClassPrefix")+n._device),r.addClass(n.getOption("deviceCssClassPrefix")+t),n._device=t,n.updateFrame(),setTimeout(function(){n._domFrame&&n._domFrame.contentWindow&&$(n._domFrame.contentWindow.window).trigger("resize")},750),e.$broadcast("MotoEvent:LivePreview.DeviceWasChanged",n)),n},updateFrame:function(){var e;this.isLoad&&((e=this.$("body")).data("device")&&e.removeClass(this.getOption("deviceCssClassPrefix")+e.data("device")),e.addClass(this.getOption("deviceCssClassPrefix")+this._device).data("device",this._device))},useStyle:function(e){var r=this;if(!this.document)return null;(e=e||{}).callback=function(e){r.disableDefaultCss(),r.insertCssInStyleTag(e),r.removeTempStyleTag()},t.css(e)},renderPresetStyles:function(e){var r=this;t.renderPresetStyles({widgetPreset:e,callback:r.insertCssInStyleTag})},renderSpacingsStyles:function(e){var r=this;t.renderSpacingsStyles({spacings:e,callback:r.insertCssInStyleTag})},renderGridStyles:function(e){var r=this;t.renderGridStyles({themeGrid:e,callback:r.insertCssInStyleTag})},renderStylesRecord:function(e){var r=this;t.renderStylesRecord({stylesRecord:e,callback:r.insertCssInStyleTag})},removeTempStyleTag:function(){var e=this.$("#"+d);e&&e.remove()},setEventManager:function(e){this._em=e},getDevice:function(){return this._device},getSize:function(){},getUrl:function(){return this._url},setVariable:function(e,r){return t.setVariable(e,r),this},unsetVariable:function(e){return t.unsetVariable(e),this},setSpacing:function(e){return t.setSpacing(e),this},unsetSpacing:function(){return t.unsetSpacing(),this},setColorsTheme:function(e){return t.setColorsTheme(e),this},setBodyBackground:function(e){var t=this,r=t.$("body");r&&t.isLoad&&e.match(t._options.backgroundClassMask)&&(r[0].className.split(/\s+/).filter(function(e){e.match(t._options.backgroundClassMask)&&r.removeClass(e)}),r.addClass(e))}},function(){return new u}}]}]),angular.module("core.library.messenger").provider("motoNotify",[function(){var e,t='<div class="moto-ui-messenger moto-ui-messenger_type-{{::$type}}" ng-click="$close()"><p class="moto-ui-messenger_message-text"><span ng-bind-html="::$message"></span></p><i class="fa fa-times-circle moto-ui-messenger_close-button"></i></div>',r=1e3,n="Ok",i="success",o=500,a=!1;this.config=function(e){e=e||{},r=angular.isDefined(e.messageDuration)?e.messageDuration:r,n=angular.isDefined(e.defaultMessageText)?e.defaultMessageText:n,i=angular.isDefined(e.messageType)?e.messageType:i,o=angular.isDefined(e.animationDuration)?e.animationDuration:o,t=angular.isDefined(e.template)?e.template:t},this.$get=["$interval","$window","$compile","$rootScope","$translate",function(s,u,l,c,d){function p(){a&&(s.cancel(f),e.animate({top:-e.height(),opacity:0},o,"swing",function(){e.remove(),a=!1}))}var f,g=c.$new(!0);return g.$close=p,{show:function(c){var h;a&&(e.stop().remove(),s.cancel(f)),h=(c=c||{}).duration||r,g.$type=c.type||i,g.$message=d.instant(c.message||n,c.translateArgs||{}),a=!0,e=l(t)(g),u.$("body").append(e),null===g.$parent.$$phase&&g.$apply(),e.css({top:-e.height()}),e.animate({top:0},o,"swing",function(){f=s(p,h,1)})},close:p}}]}]),angular.module("core.library.messenger").config(["motoNotifyProvider",function(e){e.config({messageDuration:5e3,defaultMessageText:"COMMON.MESSAGES.UPDATE_SUCCESS",messageType:"success",animationDuration:350})}]).service("coreLibraryMessenger",["motoNotify",function(e){this.message=function(t,r,n,i){e.show({message:r,duration:i,type:t,translateArgs:n})},this.info=function(e,t,r){this.message("info",e,t,r)},this.warning=function(e,t,r){this.message("warning",e,t,r)},this.success=function(e,t,r){this.message("success",e,t,r)},this.error=function(e,t,r){this.message("error",e,t,r)}}]),angular.module("core.library.modal",["ui.bootstrap","core.library.validate","pascalprecht.translate"]).provider("coreLibraryModal",[function(){function e(e){var t;e=e.currentScope||e,(t=l.indexOf(e))>-1&&l.splice(t,1)}function t(e){return l.indexOf(e)>-1}function r(){return l[l.length-1]}function n(e){var t;try{t=e.currentScope,u(function(){!e.defaultPrevented&&t&&t.cancel&&t.cancel()},150)}catch(e){}}function i(r){t(r)||(r.$on("$destroy",e),r.$on("motoPopupCanceled",n),l.push(r))}var o,a,s,u,l=[];window.$popupStack=l,angular.element(document).keydown(function(e){var t;if(27===e.keyCode){if(!(t=r())||t.escKeyDisabled)return;t.$broadcast("motoPopupCanceled")}}),(a=function(e,t,r,n,a,u){var l,c;return r&&(l=r.clientY,c=r.clientX,n+=" mini-modal "),u=u||!1,o.open({templateUrl:e,scope:s.$new(),controller:["$scope","$uibModalInstance","$timeout",function(e,n,o){e.escKeyDisabled=u,i(e),e.ok=function(){n.close(e)},e.cancel=function(){n.dismiss(e)},e.$on("$stateChangeStart",function(){n.dismiss(e)}),angular.isFunction(t)&&t.apply(this,arguments),r&&o(function(){angular.element(".mini-modal .modal-dialog").css({left:c,top:l})},1)}],backdrop:!r&&"static",keyboard:!1,windowClass:n||"",resolve:a||{}})}).iframe=function(e,t){var r;return(t=t||{}).windowClass?t.windowClass="moto-iframe-window "+t.windowClass:t.windowClass="moto-iframe-window",r={template:'<div class="modal-header modal-header_iframe" ng-show="showIframeWindow"><button type="button" class="close" ng-click="close()">&times;</button></div><div class="modal-body modal-body_iframe" ng-show="showIframeWindow"><iframe ng-src="'+e+'" scrolling="no" style="overflow:hidden;padding:0;margin:0;border:0;" allowtransparency="true" width="100%" height="100%" border="0" hspace="0" marginheight="0" marginwidth="0" vspace="0" frameBorder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe></div>',scope:s.$new(),controller:["$scope","$uibModalInstance","$timeout",function(e,r,n){t.enableLoader?(e.showIframeWindow=!1,n(function(){var r,n;(r=angular.element(".moto-iframe-window .modal-dialog")).after('<div class="spinner-icon"></div>'),(n=r.find("iframe")).on("load",function(){r.next(".spinner-icon").remove(),e.showIframeWindow=!0,e.$$phase||e.$apply(),t.autoFocus&&n.focus()})})):e.showIframeWindow=!0,e.close=function(){r.dismiss(e)},i(e),e.cancel=e.close,e.$on("$stateChangeStart",e.close)}],backdrop:t.backdrop||"static",keyboard:t.keyboard||!1,size:t.size||"",windowClass:t.windowClass,resolve:t.resolve||{}},o.open(r)},this.$get=["$rootScope","$uibModal","$timeout",function(e,t,r){return s=e,o=t,u=r,a}]}]),angular.module("core.library.PathResolver",["ng"]).provider("coreLibraryPathResolver",[function(){var e=this;e.getPath=function(e){return app.config.getPath(e)},e.getUrl=function(e,t,r){return app.config.getUrl(e,t,r)},e.getAbsoluteUrl=function(e){return app.config.getAbsoluteUrl(e)},e.getUploadAbsoluteUrl=function(e){return app.config.getUploadAbsoluteUrl(e)},e.getUploadUrl=function(e,t,r){return app.config.getUploadUrl(e,t,r)},e.getRelativeUrl=function(e,t){return app.config.getRelativeUrl(e,t)},this.$get=[function(){return{getPath:e.getPath,getUrl:e.getUrl,getAbsoluteUrl:e.getAbsoluteUrl,getUploadAbsoluteUrl:e.getUploadAbsoluteUrl,getUploadUrl:e.getUploadUrl,getRelativeUrl:e.getRelativeUrl}}]}]),angular.module("core.library.scriptsInjector",[]).service("ScriptsInjector",["$q",function(e){function t(t){this.reset=function(){this.deferredScriptsQueue=null,this.injectedScripts=null},this.inject=function(n){var i,o;return this.deferredScriptsQueue=this.deferredScriptsQueue||{},this.deferredScriptsQueue[n]?this.deferredScriptsQueue[n].promise:(o=e.defer(),this.deferredScriptsQueue[n]=o,r[n]?((i=r[n](t)).one("load",function(){this.injectedScripts=this.injectedScripts||{},this.injectedScripts[n]=!0,o.resolve()}.bind(this)),i.one("error",function(e){o.reject({error:"Can not load script",name:n,event:e})}),t.document.getElementsByTagName("head")[0].appendChild(i[0]),o.promise):(o.reject({error:"Unknown script",name:n}),o.promise))}}var r={};return this.addScript=function(e,t){r[e]=t},this.create=function(e){return new t(e)},this}]),angular.module("core.library.storage",["ngStorage","core.library.utils"]).service("MotoLocalStorage",["$localStorage","coreLibraryUtils",function(e,t){var r=this;r.addFlag=function(t,r){e[t]=e[t]||{},e[t][app.user.id]=e[t][app.user.id]||[],$.isArray(e[t][app.user.id])&&$.inArray(r,e[t][app.user.id])<0&&e[t][app.user.id].push(r)},r.removeFlag=function(t,r){var n;e[t]&&e[t][app.user.id]&&-1!=(n=$.inArray(r,e[t][app.user.id]))&&e[t][app.user.id].splice(n,1)},r.flagExists=function(t,r){return!(r&&(!e[t]||e[t]&&(!e[t][app.user.id]||e[t][app.user.id]&&$.inArray(r,e[t][app.user.id])<0)))},r.setValue=function(r,n){var i=t.getObjectValueByPath(window,"app.user.id","1");e[r]=e[r]||{},e[r][i]=n},r.getValue=function(r){var n=t.getObjectValueByPath(window,"app.user.id","1");if(e[r]&&e[r][n])return e[r][n]}}]);var app=app||{};angular.module("core.library.tutorial",["core.library.Features","core.library.languages"]).run(["$rootScope","coreLibraryTutorial",function(e,t){t.setScope(e),t.checkOnlineStatus()}]).provider("coreLibraryTutorial",["motoFeaturesProvider","coreLibraryLanguagesProvider",function(e,t){function r(e,t,n){if(angular.isUndefined(n)&&(n=null),!angular.isObject(e))return n;if(!angular.isUndefined(e[t]))return e[t];var i=angular.isArray(t)?t:t.split("."),o=i.shift();return angular.isUndefined(e[o])?n:r(e[o],i,n)}function n(e){var r=t.getProfileLocale(),n=["en_US","ru_RU","de_DE"];return angular.isUndefined(r)||-1===n.indexOf(r)?e||"en_US":r}var i,o,a,s,u,l=this,c={},d=!1,p=!1,f={url:""};this.init=function(e){return!!angular.isObject(e)&&(f=angular.extend({},f,e),this)},this.set=function(e,t){f[e]=t},c.set=this.set,this.get=function(e,t){return r(f,e,t)},c.get=this.get,this.isEnabled=function(){return p},c.isEnabled=this.isEnabled,c.checkState=function(){var t,n;if(e.isEnabled("cp_tutorial_center")){if(p=p&&d,!d)return u.$broadcast("tutorialStatusChanged",!1);n=(n=r(i.current,"motoParams.tutorialUrl","")).trim(),t=p,c.set("section",n),t!==(p=""!=n)&&u&&u.$broadcast("tutorialStatusChanged",p),s.flagExists("tutorial_visited",n)||c.open()}},c.setScope=function(e){u=e,e.$on("$stateChangeSuccess",c.checkState)},c.checkOnlineStatus=function(){if(e.isEnabled("cp_tutorial_center")){var t=c.get("url").trim();if(""==t)return!1;var r=new Date;o.jsonp(t+"status/?callback=JSON_CALLBACK&stm="+r.getFullYear()+r.getMonth()+r.getDate()+r.getHours(),{ignoreLoadingBar:!0,timeout:3e3}).success(function(e){d=e.status||!1}).error(function(e){d=!1}).then(c.checkState)}},this.open=function(t){if(e.isEnabled("cp_tutorial_center")){if(!d)return u.$broadcast("tutorialStatusChanged",!1),!1;t=t||l.get("section");var i=c.get("url").trim();if(""==i)return!1;var o={locale:n("en_US"),build:r(app,"config.settings.system.build",27),version:r(app,"config.settings.system.version","3.0.5"),section:t,now:(new Date).getTime()},p=[];for(var f in o)p.push(f+"="+o[f]);i+="?"+p.join("&"),a.iframe(i,{windowClass:"moto-iframe-window_tutorial",autoFocus:!0,enableLoader:!0}),s.addFlag("tutorial_visited",t)}},c.open=this.open,this.$get=["$state","$http","coreLibraryModal","MotoLocalStorage",function(e,t,r,n){return i=e,o=t,a=r,s=n,c}]}]),angular.module("core.library.uploader",["core.library.utils"]).value("maxAsyncFiles",2).provider("coreLibraryUploader",function(){var e,t,r,n,i,o,a=[],s=[],u=[],l=!1;(e=function(e){var t,r=this;return this.allFiles=[],this.currentUpload=[],this.allCountFiles=0,this.countUploaded=0,this.allSize=0,this.uploadSize=0,this.options={validate:!0,upload_max_size:1024,allowed_ext_list:["jpg","png","gif"],denied_ext_list:["exe","php","sh","bat","cmd","py","js"],validType:["size","allow"]},this.idx=e,this.env="coreLibraryUploader_"+e,this.interceptors=[],t=function(){},t.prototype={on:function(e,t){e&&t instanceof Function&&Signals.connect(r.env,e,t)},off:function(e,t){e&&t instanceof Function&&Signals.disconnect(r.env,e,t)},cancel:function(){0!=r.allFiles.length&&(r.allFiles=[],l=!0)},setOptions:function(e){(e=e||{}).forIn(function(e,t){r.setOption(e,t)})},getOption:function(e,t){return r.getOption(e,t)},addInterceptor:function(e){e.priority=angular.isDefined(e.priority)?e.priority:100,e.itemType=angular.isDefined(e.itemType)?e.itemType:null,r.interceptors.push(e),sortArrayByProperty(r.interceptors,"priority")},info:function(){return{allSize:r.allSize,uploadSize:r.uploadSize,formatAllSize:n.fileSize(r.allSize),formatUploadSize:n.fileSize(r.uploadSize),all:r.allCountFiles,uploaded:r.countUploaded,success:r.countSuccess,error:r.countError,isUpload:r.allCountFiles>0,usedSpace:r.allCountFiles>0?~~parseInt(r.uploadSize/r.allSize*100):0}},poolMessages:function(){var e=[];return u.forBack(function(t,n,i){t.env==r.env&&(e.push({type:t.type,args:t.args}),i.splice(n,1))}),e},upload:function(e){var t=this,n=[],i=r.getOption("validate",!0);return(e=e||{}).files&&e.files.length>0&&(r.setSignal("before",[e]),e.files.forEach(function(t){i?r.validFile(t)&&(r.allSize=r.allSize+t.size,n.push({file:t,params:e.params||null})):(r.allSize=r.allSize+t.size,n.push({file:t,params:e.params||null}))}),r.allCountFiles=r.allCountFiles+n.length,r.allFiles.push.apply(r.allFiles,n),0==n.length&&r.setSignal("after"),r.upload()),t}},new t}).prototype={idx:null,env:null,allFiles:null,currentUpload:null,allSize:0,uploadSize:0,allCountFiles:0,countUploaded:0,countSuccess:0,countError:0,options:{},setOption:function(e,t){this.options[e]=t},getOption:function(e,t){var r=this;return t=t||null,r.options.hasOwnProperty(e)?r.options[e]:t},setSignal:function(e,t){var r=this,n=[];n.push.apply(n,t),n.unshift(e),n.unshift(r.env),u.push({env:r.env,type:e,args:n||null}),Signals.trigger.apply(Signals,n)},getInterceptorsByItemType:function(e){var t,r=[];for(t in this.interceptors)null!==this.interceptors[t].itemType&&this.interceptors[t].itemType!=e||r.push(this.interceptors[t]);return r},validFile:function(e){var t,r=this,n=[],i=r.getOption("upload_max_size"),o=r.getOption("allowed_ext_list"),a=r.getOption("denied_ext_list"),s=r.getOption("validType");return!!e&&(s.indexOf("size")>=0&&(e.size<=i?n.push(!0):(n.push(!1),r.setSignal("validate",["MODULE.MEDIA_LIBRARY.FILE_TOO_LARGE_ERROR_MESSAGE",e]))),e.name.lastIndexOf(".")>=0?(t=e.name.substr(e.name.lastIndexOf(".")+1).toLowerCase(),s.indexOf("deny")>=0&&(t&&a.indexOf(t)<0?n.push(!0):(n.push(!1),r.setSignal("validate",["MODULE.MEDIA_LIBRARY.INCORRECT_EXTENSION_ERROR_MESSAGE",e]))),s.indexOf("allow")>=0&&(t&&o.indexOf(t)>=0?n.push(!0):(n.push(!1),r.setSignal("validate",["MODULE.MEDIA_LIBRARY.INCORRECT_EXTENSION_ERROR_MESSAGE",e])))):(n.push(!1),r.setSignal("validate",["MODULE.MEDIA_LIBRARY.INCORRECT_EXTENSION_ERROR_MESSAGE",e])),n.indexOf(!1)<0)},upload:function(){function e(){s.setSignal("after"),l=!1,s.allCountFiles=s.countUploaded=0,s.countError=s.countSuccess=0,s.allSize=s.uploadSize=0,s.xhrs={}}function t(e){var t,r,n;for((t=c.newRecord(e)).is_ready=0,c.insert(t),n=c.objects(),r=0;r<n.length;r++)if(n[r].id==t.id)return t}var n,s=this,u=[],c=Model("MediaLibItems"),d=a[s.idx];for(n=s.currentUpload.length-1;n>=0;n--)s.currentUpload[n].isUpload&&s.currentUpload.splice(n,1);0==s.currentUpload.length&&l&&e(),s.currentUpload.length<r&&(u=s.allFiles.splice(0,r-s.currentUpload.length)).length>0&&(u.forEach(function(e){s.currentUpload.push({file:e.file,params:e.params,isUpload:!1,inProgress:!1,thumbnails:null})}),u=null,s.currentUpload.forEach(function(r){function n(t){s.countUploaded++,s.countError++,r.isUpload=!0,t&&s.setSignal("error",[t,r.file]),s.countUploaded>=s.allCountFiles&&e(),s.upload()}var a=0,u=!1;r.inProgress||(r.inProgress=!0,d(r.file,r.params,function(e){s.uploadSize=s.uploadSize+(e.loaded-a),s.setSignal("progress"),(a=e.loaded)-e.loaded!=0||u||(u=!0,s.uploadSize=s.uploadSize+(r.file.size-e.total))}).then(function(a){function u(){h.is_ready=1,c.save(h),o.$broadcast("MotoEvent:uploadedItemReady",{item:h})}function l(){s.countUploaded++,s.countSuccess++,r.isUpload=!0,u(),s.countUploaded>=s.allCountFiles&&e(),s.upload()}function d(e){u(),n(e)}function p(){f<g.length?(f++,i.when(g[f-1].onSuccess(h)).then(p,d)):l()}var f,g,h;f=0,h=t(a),g=s.getInterceptorsByItemType(h.type),p()},n))}))}},t=function(t){var r=a.indexOf(t);return r<0&&(r=a.push(t)-1,s[r]=new e(r)),s[r]},this.$get=["maxAsyncFiles","coreLibraryUtils","$q","$rootScope",function(e,a,s,u){return r=e,n=a,i=s,o=u,function(e){return t(e)}}]}),angular.module("core.library.urlGenerator",[]).provider("coreLibraryUrlGenerator",function(){var UrlGenerator;UrlGenerator=function(){var e=this;e._value="",e.isMake=!1,e._parent=null},UrlGenerator.prototype={isMake:!1,_value:null,_parent:null,set value(e){var t=this;t.isMake=""!=e,t.prepareValue(e)},get value(){var e,t=this;return e=t._value,t._parent&&(e=t._parent+"/"+e),e},setParent:function(e){var t=this;return t._parent=e,t},prepareValue:function(e){var t=this;t._value=e.toString(),t.replSpace().replUpper().replTranslit().replUndefined()},setValue:function(e){var t=this;return t.isMake||t.prepareValue(e),t},replSpace:function(){var e=this;return e._value=e._value.replace_all(" ","-"),e},replUpper:function(){var e=this;return e._value=e._value.toLowerCase(),e},replUndefined:function(){var e,t,r=this,n=r._value.split("");for(e=n.length-1;e>=0;e--)45==(t=n[e].charCodeAt())||95==t||t>=48&&t<=57||t>=97&&t<=122||n.splice(e,1);return r._value=n.join(""),r},replTranslit:function(){var self=this,tr='a b v g d e ["zh","j"] z i y k l m n o p r s t u f h c ch sh ["shh","shch"] ~ y ~ e yu ya ~ ["jo","e"]'.split(" "),val=self._value.split(""),i,cc,ch,v;for(i=val.length-1;i>=0;i--)(v=val[i].charCodeAt())>=0&&v<=64||v>=91&&v<=127||(cc=v,(ch=cc>=1072?tr[cc-1072]:val[i])?ch.length<3?val[i]=ch:val[i]=eval(ch)[0]:val[i]="");return self._value=val.join(""),self}},this.$get=[function(){return function(){return new UrlGenerator}}]}),angular.module("core.library.utils").provider("coreLibrarySpacingHelper",[function(){function e(){r=new RegExp("^"+i+"-("+o.join("|")+")-("+a.join("|")+")$")}function t(e){var t;if(!angular.isString(e))return null;for(t in s)if(s.hasOwnProperty(t)&&s[t]===e)return t;return" "}var r,n=this,i="moto-spacing",o=["top","right","bottom","left"],a=["auto","zero","small","medium","large"],s={a:"auto",z:"zero",s:"small",m:"medium",l:"large"};n.addValue=function(t,r){return!!angular.isString(t)&&(!(angular.isString(r)&&r.length>1)&&(!(a.indexOf(t)>-1)&&(a.push(t),r&&(s[r]=t),e(),!0)))},n.parseShort=function(e,t){var r,n,i,a;if(!angular.isString(e))return null;for(angular.isObject(t)&&!angular.isArray(t)||(t={}),n=Math.min(o.length,e.length),r=0;r<n;r++)i=o[r],a=e[r],(a=s[a])&&(t[i]=a);return t},n.generateShort=function(e){var r,n,i="";if(!angular.isObject(e)||angular.isArray(e))return null;for(r=0,n=o.length;r<n;r++)i+=t(e[o[r]]);return i},n.parseClasses=function(e,t){var n,i,o,s;if(angular.isString(e)&&(e=e.split(" ")),!angular.isArray(e))return null;for(angular.isObject(t)&&!angular.isArray(t)||(t={}),n=0,i=e.length;n<i;n++)o=e[n],angular.isString(o)&&(o=o.trim()).length&&(s=r.exec(o))&&(!t[s[1]]||a.indexOf(s[2])>a.indexOf(t[s[1]]))&&(t[s[1]]=s[2]);return t},n.generateSpacings=function(e){var t,r,n,s,u=[];if(!angular.isObject(e)||angular.isArray(e))return null;for(t=0,r=o.length;t<r;t++)n=e[s=o[t]],a.indexOf(n)>-1&&u.push(i+"-"+s+"-"+n);return u.join(" ")},n.removeSpacingInElement=function(e,t){var n,i,a,s;if(!angular.isElement(e))return!1;if(n=e.attr("class"),!angular.isString(n))return!0;for("*"===t?t=o:angular.isArray(t)||(t=[t]),i=0,a=(n=n.split(" ")).length;i<a;i++)(s=r.exec(n[i]))&&-1!==t.indexOf(s[1])&&(n[i]="");return n=n.join(" "),n=n.replace(/\s+/g," ").trim(),e.attr("class",n),!0},n.parseElement=function(e,t){return angular.isElement(e)?n.parseClasses(e.attr("class"),t):null},n.setSpacingInElement=function(e,t,r){return!!angular.isElement(e)&&(-1!==o.indexOf(t)&&(null===r?(n.removeSpacingInElement(e,t),!0):-1!==a.indexOf(r)&&(n.removeSpacingInElement(e,t),e.addClass(i+"-"+t+"-"+r),!0)))},n.updateSpacingInElement=function(e,t){var r,s,u,l=[];if(!angular.isElement(e))return!1;if(!angular.isObject(t)||angular.isArray(t))return!1;for(r=0,s=o.length;r<s;r++)(null===(u=t[o[r]])||a.indexOf(u)>-1)&&l.push(o[r]);if(!l.length)return!1;for(n.removeSpacingInElement(e,l),r=0,s=l.length;r<s;r++)(u=t[l[r]])&&e.addClass(i+"-"+l[r]+"-"+u);return!0},e(),this.$get=[function(){return{parseShort:n.parseShort,generateShort:n.generateShort,parseFromClasses:n.parseClasses,generateSpacings:n.generateSpacings,parseElement:n.parseElement,setSpacingInElement:n.setSpacingInElement,removeSpacingInElement:n.removeSpacingInElement,updateSpacingInElement:n.updateSpacingInElement}}]}]),angular.module("core.library.utils").provider("coreLibraryUtils",["coreLibraryConfigProvider",function(e){function t(){return{convertToTwoDigitHexCodeFromDecimal:function(e){var t=Math.round(e).toString(16);return t.length>1||(t="0"+t),t},hue2rgb:function(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e},hslToRgb:function(e,t,r){var n,i,o,a=this;if(0==t)n=i=o=r;else{var s=r<.5?r*(1+t):r+t-r*t,u=2*r-s;n=a.hue2rgb(u,s,e+1/3),i=a.hue2rgb(u,s,e),o=a.hue2rgb(u,s,e-1/3)}return[255*n,255*i,255*o]},rgbToHsl:function(e,t,r){e/=255,t/=255,r/=255;var n,i,o=Math.max(e,t,r),a=Math.min(e,t,r),s=(o+a)/2;if(o==a)n=i=0;else{var u=o-a;switch(i=s>.5?u/(2-o-a):u/(o+a),o){case e:n=(t-r)/u+(t<r?6:0);break;case t:n=(r-e)/u+2;break;case r:n=(e-t)/u+4}n/=6}return[n,i,s]},hex:function(e){return 10==e?"a":11==e?"b":12==e?"c":13==e?"d":14==e?"e":15==e?"f":e.toString()},hexToRGB:function(e){return e=e.toLowerCase(),{r:parseInt(e.substring(0,2),16)||0,g:parseInt(e.substring(2,4),16)||0,b:parseInt(e.substring(4,6),16)||0}},rgbToHex:function(e){var t,r=this;return t=r.hex(Math.floor(e.r/16)),t+=r.hex(e.r%16),t+=r.hex(Math.floor(e.g/16)),t+=r.hex(e.g%16),t+=r.hex(Math.floor(e.b/16)),t+=r.hex(e.b%16)}}}function r(e,t){var r;return angular.isObject(e)&&(t=e.height,e=e.width),e=parseInt(e),t=parseInt(t),r=e/t,{setWidth:function(t){return{width:t,height:Math.round(t/r),scale:t/e}},setHeight:function(e){return{width:Math.round(e*r),height:e,scale:e/t}},setScale:function(r){return{width:Math.round(e*r),height:Math.round(t*r),scale:r}}}}function n(e){var t,r=["Bytes","KB","MB","GB","TB"],n=parseInt(e);return 0===n?"0 Bytes":(t=parseInt(Math.floor(Math.log(n)/Math.log(1024))))>=2?(n/Math.pow(1024,t)).toFixed(2)+" "+r[t]:Math.round(n/Math.pow(1024,t))+" "+r[t]}function i(t,r,n){(r=r||{}).permalinks==n&&(r.permalinks=e.get("settings.website.permalinks")),angular.isString(r.permalinks)&&(r.permalinks=N.convertToBoolean(r.permalinks)),r.suffix==n&&(r.suffix=e.get("settings.website.suffix")),angular.isString(r.suffix)&&(r.suffix=N.convertToBoolean(r.suffix));var i=[],o={prefix:"",suffix:"",site:e.get("settings.website.address")};if(parseInt(e.get("settings.website.main_page"))==parseInt(t.id))return o.site;for(r.permalinks?r.suffix?o.suffix=".html":o.suffix="/":o.prefix="?url=";null!=t;)i.push(t.url),t=t.parent;return i.reverse(),o.site+o.prefix+i.join("/")+o.suffix}function o(e,t){return jQuery.extend(!0,e,t)}function a(e){e.yesHandler=e.yesHandler||angular.noop,e.noHandler=e.noHandler||angular.noop,D("views/components/ui/modal/confirm.tpl.html",function(t,r){t.question=e.question||"COMMON.TEXT.UNSAVED_CHANGES_CONFIRMATION",t.translate_params=e.translate_params,t.ok=function(){r.close(t),angular.isFunction(e.yesHandler)&&e.yesHandler()},t.cancel=function(){r.close(t),angular.isFunction(e.noHandler)&&e.noHandler()}})}function s(e,t){var r,n,i,o;return o=e+"_script",(i=$("#"+o)).length?i.is("[loading]")?r=i.data("deferred"):(r=L.defer()).resolve():((n=document.createElement("script")).setAttribute("loading",""),n.setAttribute("id",o),n.src=t,r=L.defer(),(i=$(n)).data("deferred",r),i.one("load",function(){n.removeAttribute("loading"),(r=i.data("deferred")).resolve(),i.removeData("deferred")}),document.getElementsByTagName("head")[0].appendChild(n)),r.promise}function u(e,t){var r,n;for(!t&&(t="-"),t=t.split(""),n=0;n<t.length;n++)r=new RegExp("\\"+t[n]+".","g"),e=e.replace(r,function(e){return e[1].toUpperCase()});return e}function l(e,t){return!t&&(t="-"),e.replace(/[A-Z]/g,function(e){return t+e.toLowerCase()})}function c(e){return $.map(e[0].attributes,function(e){return e.name})}function d(e){e.attr("class",e.attr("class").trim().replace(/\s\s+/g," "))}function p(e){return!0===e||"1"===e||1===e||"true"===e||parseInt(e)>0}function f(e){return parseInt(e)||0}function g(e){return angular.isUndefined(e)||null===e?"":""+e}function h(e){if(angular.isDate(e))return e;var t="";return angular.isObject(e)&&!angular.isUndefined(e.sec)?e=parseInt(e.sec):angular.isString(e)&&(-1==(e=e.trim()).indexOf(" ")?e=parseInt(e):t=new Date(e)),angular.isNumber(e)&&(t=new Date(1e3*e)),t}function m(e,t){return angular.isUndefined(t)?e:"integer"==t||"int"==t?f(e):"boolean"===t||"bool"===t?p(e):"string"==t?g(e):"object"!=t&&"array"!=t||!angular.isString(e)?"datetime"==t||"date"==t?h(e):e:angular.fromJson(e)}function v(e){return(e=g(e)).charAt(0).toUpperCase()+e.substr(1)}function y(e,t){if(!angular.isString(e)&&!angular.isNumber(e))return t||j;if(!(e+="").length)return"";var r,n,i,o="";for(n=0,i=e.length;n<i;n++)(r=e.charCodeAt(n))<128?o+=String.fromCharCode(r):r>127&&r<2048?(o+=String.fromCharCode(r>>6|192),o+=String.fromCharCode(63&r|128)):(o+=String.fromCharCode(r>>12|224),o+=String.fromCharCode(r>>6&63|128),o+=String.fromCharCode(63&r|128));return o}function b(e,t){if(!angular.isString(e)&&!angular.isNumber(e))return t||j;if(!(e+="").length)return"";var r,n,i,o,a,s,u,l="",c=0;for(e=y(e);c<e.length;)o=(r=e.charCodeAt(c++))>>2,a=(3&r)<<4|(n=e.charCodeAt(c++))>>4,s=(15&n)<<2|(i=e.charCodeAt(c++))>>6,u=63&i,isNaN(n)?s=u=64:isNaN(i)&&(u=64),l=l+F.charAt(o)+F.charAt(a)+F.charAt(s)+F.charAt(u);return l}function _(e,t){if(!angular.isString(e)&&!angular.isNumber(e))return t||j;if(!(e+="").length)return"";for(var r="",n=0,i=0,o=0,a=0;a<e.length;)(n=e.charCodeAt(a))<128?(r+=String.fromCharCode(n),a++):n>191&&n<224?(i=e.charCodeAt(a+1),r+=String.fromCharCode((31&n)<<6|63&i),a+=2):(i=e.charCodeAt(a+1),o=e.charCodeAt(a+2),r+=String.fromCharCode((15&n)<<12|(63&i)<<6|63&o),a+=3);return r}function w(e,t){if(!angular.isString(e)&&!angular.isNumber(e))return t||j;if(!(e+="").length)return"";var r,n,i,o,a,s,u="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)r=F.indexOf(e.charAt(l++))<<2|(o=F.indexOf(e.charAt(l++)))>>4,n=(15&o)<<4|(a=F.indexOf(e.charAt(l++)))>>2,i=(3&a)<<6|(s=F.indexOf(e.charAt(l++))),u+=String.fromCharCode(r),64!=a&&(u+=String.fromCharCode(n)),64!=s&&(u+=String.fromCharCode(i));return u=_(u)}function S(e){return e&&e.window===e}function O(e){return e&&e.$evalAsync&&e.$watch}function I(e){return e&&angular.isFunction(e.then)}function E(e){return e&&angular.isFunction(e.resolve)&&angular.isFunction(e.reject)}function C(e,t){var r;if(!angular.isObject(t))return e;for(r in t)t.hasOwnProperty(r)&&(e[r]=angular.copy(t[r]));return e}function T(e){return U.call(e)}function x(e){return"[object Object]"===T(e)}function A(e,t,r){var n,i,o,a;if(!x(e)||!x(t))return!1;angular.isNumber(r)||(r=0),n={};for(o in t)if(t.hasOwnProperty(o))if(e.hasOwnProperty(o)){if(e[o]!==t[o])if(T(e[o])===T(t[o])){if(r&&angular.isObject(t[o])){if(!angular.isObject(e[o])){n[o]=t[o],i=!0;continue}if(r>0&&(a=A(e[o],t[o],r-1))){n[o]=a,i=!0;continue}}angular.equals(e[o],t[o])||(n[o]=t[o],i=!0)}else n[o]=t[o],i=!0}else n[o]=t[o],i=!0;return i?n:null}function P(e,t,r){var n,i,o,a,s=[];if(!angular.isObject(e))return s;angular.isNumber(t)&&(r=t),angular.isString(t)||(t="."),angular.isNumber(r)||(r=3);for(n in e)if(e.hasOwnProperty(n))if(r&&angular.isObject(e[n])&&!angular.isArray(e[n])&&!angular.isElement(e[n])){if((i=P(e[n],t,r-1)).length)for(o=0,a=i.length;o<a;o++)s.push(n+t+i[o])}else s.push(n);return s}function k(e,t,r){var n,i,o;try{for(i=t.split("."),o=e,n=0;n<i.length;n++)angular.isDefined(o)&&(o=o[i[n]]);if(angular.isDefined(o))return o}catch(e){}return r}function R(e){var t;if((t=angular.isString(e)?$("<div>"+e+"</div>"):e).find("*").addBack().contents().filter(function(){return 8===this.nodeType}).remove(),angular.isString(e))return t.html()}function M(e,t){e.sort(function(e,r){return e[t]<r[t]?-1:e[t]>r[t]?1:0})}var D,L,N,U=Object.prototype.toString,F="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",j="";return app.coreUtilsService=new function(){this.rgb=t,this.fileSize=n,this.deepExtend=o,this.generateFullPageUrl=i,this.openConfirmationBox=a,this.loadScript=s,this.toCamelCase=u,this.fromCamelCase=l,this.getAttributes=c,this.prettifyClassAttribute=d,this.convertValue=m,this.convertToBoolean=p,this.convertToInteger=f,this.convertToString=g,this.convertToDate=h,this.ucfirst=v,this.utf8Encode=y,this.base64Encode=b,this.utf8Decode=_,this.base64Decode=w,this.isWindowLikeObject=S,this.isScopeLikeObject=O,this.isPromiseLikeObject=I,this.isDeferredLikeObject=E,this.getTypeOff=T,this.assignWithCopy=C,this.objectDiffQuick=A,this.objectKeysDeepPlain=P,this.getObjectValueByPath=k,this.removeComments=R,this.sortArrayByProperty=M,this.proportionalResize=r,this.configure=function(e){D=e.coreLibraryModal,L=e.$q}},N=app.coreUtilsService,{rgb:t,fileSize:n,deepExtend:o,generateFullPageUrl:i,openConfirmationBox:a,loadScript:s,toCamelCase:u,fromCamelCase:l,getAttributes:c,prettifyClassAttribute:d,convertValue:m,convertToBoolean:p,convertToInteger:f,convertToString:g,convertToDate:h,ucfirst:v,utf8Encode:y,base64Encode:b,utf8Decode:_,base64Decode:w,isWindowLikeObject:S,isScopeLikeObject:O,isPromiseLikeObject:I,isDeferredLikeObject:E,getTypeOff:T,assignWithCopy:C,objectDiffQuick:A,objectKeysDeepPlain:P,getObjectValueByPath:k,removeComments:R,sortArrayByProperty:M,proportionalResize:r,$get:["coreLibraryModal","$q",function(e,t){return app.coreUtilsService.configure({coreLibraryModal:e,$q:t}),app.coreUtilsService}]}}]),angular.module("core.library.validate").directive("form",[function(){return{restrict:"E",link:function(e,t,r){function n(){d.forIn(function(e){d[e]&&d[e].clearBalloon&&d[e].clearBalloon()})}function i(){return d.forIn(function(e){d[e]&&d[e].validate&&d[e].validate()}),d.$valid}function o(e,t){var r;angular.isArray(e)?(r={isValid:!1,data:{}},e.forEach(function(e){r.data[e]={key:e,isValid:!1}}),d[t]&&d[t].setValidity&&d[t].setValidity(r)):angular.isObject(e)&&e.forIn(function(e,t){o(t,e)})}function a(e){e.data&&e.data.errors&&!Array.isArray(e.data.errors)&&o(e.data.errors)}function s(e){return e.stopPropagation(),e.preventDefault(),!1}function u(){p||(t.on("submit",s),p=!0)}function l(){p&&(t.off("submit",s),p=!1)}function c(){return l(),!1}var d,p=!1;e.$on("$destroy",function(){c()}),r.$observe("name",function(){var t=!1;return r.name&&e[r.name]&&(d=e[r.name],u(),d.setValidity=a,d.validate=i,d.clearErrors=n,t=!0),t})}}}]),angular.module("core.library.validate").directive("validate",["$translate","coreLibraryValidation",function(e,t){return{restrict:"A",require:"ngModel",link:function(r,n,i,o){function a(){var e;return i.confirm&&(e=r.$eval(i.confirm)),e}function s(){h&&h.remove(),g.removeClass(_)}function u(t){o.$error.forIn(function(e){o.$setValidity(e,!0)}),s(),t.isValid?g.removeClass(_):(g.addClass(_),t.data.forIn(function(t,r){var n,i=r.args;switch(r.key){case"stringLengthTooShort":n="COMMON.VALIDATION_ERROR.STRING_LENGTH_TOO_SHORT",i=v.minLen?{minimum_character_count:v.minLen}:{};break;case"stringLengthTooLong":n="COMMON.VALIDATION_ERROR.STRING_LENGTH_TOO_LONG",i=v.maxLen?{maximum_character_count:v.maxLen}:{};break;case"isEmpty":n="COMMON.VALIDATION_ERROR.REQUIRED_VALUE";break;case"incorrectURL":n="COMMON.VALIDATION_ERROR.INCORRECT_URL";break;case"hostnameUnknownTld":n="COMMON.VALIDATION_ERROR.UNKNOWN_TLD_FOR_HOSTNAME";break;case"hostnameLocalNameNotAllowed":n="COMMON.VALIDATION_ERROR.LOCAL_NAME_NOT_ALLOWED_FOR_HOSTNAME";break;case"hostnameInvalidHostname":case"hostnameInvalidHostnameSchema":n="COMMON.VALIDATION_ERROR.INCORRECT_HOSTNAME";break;case"hostnameInvalidUri":n="COMMON.VALIDATION_ERROR.INCORRECT_HOSTNAME_URI";break;case"emailAddressInvalidFormat":case"emailAddressInvalidHostname":n="COMMON.VALIDATION_ERROR.INCORRECT_EMAIL";break;case"valueNotConfirm":case"notSame":n="COMMON.VALIDATION_ERROR.NOT_CONFIRMED_VALUE";break;case"valueInvalid":n="COMMON.VALIDATION_ERROR.INCORRECT_VALUE";break;case"recordFound":n="COMMON.VALIDATION_ERROR.VALUE_ALREADY_EXISTS";break;default:n=r.key}o.$setValidity(r.key,r.isValid),r.message=e.instant(n,i)}),h=n.balloon({position:m,data:t}),(y=r.$eval(i.balloonStyle))&&h.css(y))}function l(){i.confirm&&f.setValidateOption("confirm",a()),u(f.validate(o.$viewValue))}function c(){b||(n.on("blur",l),b=!0)}function d(){b&&(n.off("blur",l),b=!1)}function p(){return d(),!1}var f,g,h,m,v,y,b=!1,_="group-not-valid";g=n.closest(".form-group"),r.$on("$destroy",function(){p()}),i.$observe("validate",function(){var e,n=!1;return i.validate&&(e=r.$eval(i.validate))&&(v=e,c(),f=t.getValidatorByOptions(e),m=i.validatePosition||"right",o.setValidity=u,o.validate=l,o.clearBalloon=s,n=!0),n})}}}]),angular.module("core.library.validate").provider("coreLibraryValidation",[function(){function e(e){var t,r,n,i;for(t=e.indexOf("//"),t=(n=e.substr(t+2)).indexOf("/"),r=n.substr(0,t).split("."),i=0;i<r.length;i++)if(r[i].length>=64)return!1;return!0}function t(e,t){var r={isValid:!1,key:o.TOO_LONG,args:{MaxLen:t}};return void 0===e||null===e?(r.isValid=!0,r.key=""):t>=(e=e.toString().trim()).length&&(r.isValid=!0,r.key=""),r}function r(e,t){var r={isValid:!1,key:o.TOO_SHORT,args:{MinLen:t}};return void 0===e||null===e?(r.isValid=!0,r.key=""):t<=(e=e.toString().trim()).length&&(r.isValid=!0,r.key=""),r}function n(e,t){var r={isValid:!1,key:o.VALUE_INVALID,args:{}};return t=new RegExp(t),void 0===e||null===e?(r.isValid=!0,r.key=""):t.test(e)&&(r.isValid=!0,r.key=""),r}var i={},o={TOO_SHORT:"stringLengthTooShort",TOO_LONG:"stringLengthTooLong",IS_EMPTY:"isEmpty",EMAIL_INVALID:"emailAddressInvalidHostname",URL_INVALID:"incorrectURL",NOT_CONFIRM:"valueNotConfirm",NUMBER_BIGGER:"numberIsBigger",NUMBER_SMALLER:"numberIsSmaller",VALUE_INVALID:"valueInvalid"},a=function(e){var t=this;t&&(e=e||{},t._options={},e.forIn(function(e,r){i.hasOwnProperty(e)&&(t._options[e]=r)}))};a.prototype={_options:null,setValidateOption:function(e,t){var r=this;i[e]&&(r._options[e]=t)},validate:function(e){var t={isValid:!0,data:{}};return this._options.forIn(function(r,n){var o;o=(0,i[r])(e,n),t.data[r]=o,t.isValid&&!1===o.isValid&&(t.isValid=!1)}),t}},i={req:function(e){var t={isValid:!1,key:o.IS_EMPTY,args:{}};return e=void 0===e||null===e?"":e.toString(),(e=e.trim())&&e.length>0&&(t.isValid=!0,t.key=""),t},email:function(e){var t=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,r={isValid:!1,key:o.EMAIL_INVALID,args:{}};return e&&!t.test(e)||(r.isValid=!0,r.key=""),r},url:function(t){var r={isValid:!1,key:o.URL_INVALID,args:{}},n=/^((?:(?:https?|ftp):\/\/)|(?:\/\/))(?:\S+(?::\S*)?@)?(?:(?!(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:[a-z\u00a1-\uffff]+))(?::\d{2,5})?(?:\/\S*)?$/i;return void 0===t||null===t?(r.isValid=!0,r.key=""):(!t||0===t.length||e(t)&&n.test(t))&&(r.isValid=!0,r.key=""),r},max:function(e,t){var r={isValid:!1,key:o.NUMBER_BIGGER,args:{Max:t}};return void 0===e||null===e?(r.isValid=!0,r.key=""):t>=(e=e.indexOf(".")>=0?parseFloat(e):parseInt(e))&&(r.isValid=!0,r.key=""),r},min:function(e,t){var r={isValid:!1,key:o.NUMBER_SMALLER,args:{Min:t}};return void 0===e||null===e?(r.isValid=!0,r.key=""):t<=(e=e.indexOf(".")>=0?parseFloat(e):parseInt(e))&&(r.isValid=!0,r.key=""),r},maxLen:t,minLen:r,confirm:function(e,t){var r={isValid:!1,key:o.NOT_CONFIRM,args:{}};return e===t&&(r.isValid=!0,r.key=""),r},regExp:n,reg_exp:n,min_len:r,max_len:t},this.setValidator=function(e,t){i[e]=t},this.getValidator=function(e,t){return i[e]||t},this.getValidatorByOptions=function(e){return new a(e)},this.getAllValidators=function(){return i},this.getErrorMessages=function(){return o},this.getErrorMessage=function(e,t){return o[e]||t},this.setErrorMessage=function(e,t){o[e]=t},this.$get=[function(){return this}]}]),angular.module("core.library.viewportInitialScale").directive("viewportInitialScale",["$window","viewportInitialScaleService",function(e,t){return{restrict:"A",link:function(r,n,i){var o,a,s,u;r.setInitialScale=function(){o="width=device-width, initial-scale=1",a=t.checkMediaQuery("(max-device-width: 567px)"),s=t.checkMediaQuery("(min-device-width: 568px) and (max-device-width: 749px)"),u=t.checkMediaQuery("(min-device-width: 750px) and (max-device-width: 1024px)"),a?o="width=device-width, initial-scale=0.27":s?o="width=device-width, initial-scale=0.5":u&&(o="width=device-width, initial-scale=0.65"),i.$set("content",o)},r.setInitialScale(),angular.element(e).bind("resize",function(){t.isDesktop()||r.setInitialScale()})}}}]),angular.module("core.library.viewportInitialScale").provider("viewportInitialScaleService",[function(){var e={phone:"(max-device-width: 767px)",tablet:"(min-device-width: 768px) and (max-device-width: 1024px)",desktop:"(min-device-width: 1025px)",portrait:"(orientation: portrait)",landscape:"(orientation: landscape)",retina:"(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)"};this.setRule=function(t,r){return e[t]=r,this},this.setRules=function(e){var t;for(t in e)e.hasOwnProperty(t)&&this.setRule(t,e[t]);return this},this.$get=["$window",function(t){var r={};return r.checkMediaQuery=function(e){if(e)return t.matchMedia(e).matches},r.isPhone=function(){return t.matchMedia(e.phone).matches},r.isTablet=function(){return t.matchMedia(e.tablet).matches},r.isDesktop=function(){return t.matchMedia(e.desktop).matches},r.isPortrait=function(){return t.matchMedia(e.portrait).matches},r.isLandscape=function(){return t.matchMedia(e.landscape).matches},r.isRetina=function(){return t.matchMedia(e.retina).matches},r}]}]);var Model;!function(){var e,t,r,n,i,o,a,s,u={},l=["insert","delete","save","load","remove"];s=function(e){var t={};return this.forIn(function(e,r){"_"!=e[0]&&(r&&"object"==typeof r?(r.toJSON=r.toJSON||s,t[e]=r.toJSON()):r instanceof Function||(t[e]=!0===r?1:!1===r?0:r))}),t},(i=function(e,t){var r=this,n=u[e].classObj;r.indexes=n.index,r.indexes.indexOf("id")<0&&r.indexes.push("id"),r.index={},t.forEach(function(e,t){r.add(e,t)})}).prototype={PREF:"idx_",index:null,indexes:null,add:function(e,t){var r=this;r.indexes.forEach(function(n){r.index[n]=r.index[n]||{},e.hasOwnProperty(n)&&(r.index[n][r.PREF+e[n]]=t)})},remove:function(e,t){var r=this;r.indexes.forEach(function(e){r.index[e]=r.index[e]||{},t.hasOwnProperty(e)&&r.index.hasOwnProperty(e)&&r.index[e].hasOwnProperty(r.PREF+t[e])&&delete r.index[e][r.PREF+t[e]]})},getKey:function(e,t){var r=this;return r.index.hasOwnProperty(e)&&r.index[e].hasOwnProperty(r.PREF+t)?r.index[e][r.PREF+t]:null}},(o=function(e,t){var r=this;r.maps=t.maps||{list:"getList"},r.params=t.params||{page:1,limit:0},r.service=t.service||null,r.records=t.records||null,r.isReady=!0,r.promise_success=[],r.promise_error=[],null==r.service&&t.records instanceof Array&&(u[e].cache={records:t.records},r.createIndexes(e,t.records))}).prototype={maps:null,params:null,service:null,records:null,isReady:!0,promise_success:null,promise_error:null,setSuccess:function(e){var t=this;e&&e instanceof Function&&t.promise_success.indexOf(e)<0&&t.promise_success.push(e)},setError:function(e){var t=this;e&&e instanceof Function&&t.promise_error.indexOf(e)<0&&t.promise_error.push(e)},createIndexes:function(e,t){u[e].indexes=new i(e,t)},runPromiseSuccess:function(e){var t=this;t.promise_success.forEach(function(t){t.apply(e)}),t.promise_success=t.promise_success.splice(),t.promise_error=t.promise_error.splice()},runPromiseError:function(e){var t=this;t.promise_error.forEach(function(t){t.apply(e)}),t.promise_success=t.promise_success.splice(),t.promise_error=t.promise_error.splice()},load:function(e,t,r){var n=this,i=e._p.getProp("modelName");n.isReady&&(n.isReady=!1,void 0===t&&(t=!0),null==n.service||t?(n.isReady=!0,Signals.trigger("__MODEL__"+i,"load"),n.runPromiseSuccess(e)):n.service&&"object"==typeof n.service&&n.service.hasOwnProperty(n.maps.list)&&n.service[n.maps.list](r||n.params).then(function(t){"object"!=typeof t||t.hasOwnProperty("meta")||t.hasOwnProperty("records")||(t={meta:{},records:[t]}),t.records&&Array.isArray(t.records)&&(u[i].cache=t,n.createIndexes(i,t.records),Signals.trigger("__MODEL__"+i,"load")),n.isReady=!0,n.runPromiseSuccess(e)},function(t){n.isReady=!0,n.runPromiseError(e)}))}},a=function(){var e={};return{setProp:function(t,r){e[t]=r},getProp:function(t,r){return e.hasOwnProperty(t)?!e[t]&&r?r:e[t]:r||null}}},((t=function(e,t){var n=this,i=["proxy","record","limit","orderBy","first"],o=u[e].classObj,a=o.record;n.push.apply(n,t),n.forEach(function(t,n,i){a instanceof Function?i[n]=new a(e,t):i[n]=new r(e,t)}),o.forIn(function(e,t){i.indexOf(e)<0&&t instanceof Function&&(n[e]=t)})}).prototype=new Array).first=function(){var e=this;return e.length>0?e[0]:null},t.prototype.limit=function(e,t){var r,n,i,o=this;return e=e||1,t=t||20,r=20*(e-1),n=r+t,i=o.slice(r,n),o.splice(0),o.push.apply(o,i),o},t.prototype.orderBy=function(e,t){var r=this;return r.sort(function(r,n){var i=r[e],o=n[e];return"string"==typeof i&&"string"==typeof o?[i,o].sort()[0]===i?"asc"==t?-1:1:"asc"==t?1:-1:"number"==typeof i&&"number"==typeof o?"asc"==t?i-o:o-i:"boolean"==typeof i&&"boolean"==typeof o?(i=!0===i?1:0,o=!0===o?1:0,"asc"==t?o-i:i-o):0}),r},(r=function(e,t){var r=this,i=[],o=u[e].classObj.record;o&&o.forIn(function(e,a){var s,u,l,c,d;if(i.indexOf(e)<0)if(a instanceof n)if(t){if(u={cls:a,val:t[e]},s=e,a.isForeign()){if(s=s.replace("_id",""),r.hasOwnProperty(s))throw'Record is have a property "'+s+'"';Object.defineProperty(r,e,{set:function(e){u.val=e},get:function(){return u.cls.option.type.transform(u.val)},enumerable:!0})}Object.defineProperty(r,s,{set:function(e){u.val=e},get:function(){return u.cls.transform(u.val)},enumerable:!0})}else r[e]=null;else a instanceof Function&&t&&t.hasOwnProperty(e)?r[e]=a.apply(r,[t[e]]):a instanceof Function?r[e]=function(){return a.apply(r,arguments)}:t&&t.hasOwnProperty(e)?r[e]=t[e]:(l=Object.getOwnPropertyDescriptor(o,e))&&l.get instanceof Function&&l.set instanceof Function?(c=l.set,d=l.get,Object.defineProperty(r,e,{set:function(e){var t=this;c.call(t,e)},get:function(){var e=this;return d.call(e)},enumerable:!0,configurable:!0})):r[e]=a})}).prototype={},(e=function(e){var t=this;t._p=a(),t._p.setProp("modelName",e)}).prototype={_p:null,get loading(){return!u[this._p.getProp("modelName")].proxy.isReady},set loading(e){},count:function(){var e=this._p.getProp("modelName"),t=0;return u[e]&&Array.isArray(u[e].cache.records)&&(t=u[e].cache.records.length),t},load:function(e,t){var r=this;return u[r._p.getProp("modelName")].proxy.load(r,e,t),r},newRecord:function(e){var t=this,n=u[t._p.getProp("modelName")].classObj.record;return n instanceof Function?new n(t._p.getProp("modelName"),e):new r(t._p.getProp("modelName"),e)},insert:function(e){var t,r,n=this,i=n._p.getProp("modelName");return e=e||{},e.toJSON=e.toJSON||s,t=e.toJSON(),!(!u[i]||!Array.isArray(u[i].cache.records))&&(r=u[i].cache.records.push(t),u[i].indexes.add(t,r-1),Signals.trigger("__MODEL__"+n._p.getProp("modelName"),"insert",e,t),!0)},remove:function(e){var t,r=this,n=r._p.getProp("modelName");return!!(e&&e.id&&null!=(t=u[n].indexes.getKey("id",e.id))&&u[n].cache.records&&u[n].cache.records[t])&&(u[n].cache.records.splice(t,1),u[n].proxy.createIndexes(n,u[n].cache.records),Signals.trigger("__MODEL__"+r._p.getProp("modelName"),"remove",e),!0)},save:function(e){var t,r,n=this,i=n._p.getProp("modelName");if(e&&e.hasOwnProperty("id")){if(null==(r=u[i].indexes.getKey("id",e.id)))return n.insert(e);if(u[i].cache.records&&u[i].cache.records[r])return e.toJSON=e.toJSON||s,t=e.toJSON(),u[i].cache.records[r]=t,u[i].proxy.createIndexes(i,u[i].cache.records),Signals.trigger("__MODEL__"+n._p.getProp("modelName"),"save",e),!0}return!1},on:function(e,t){var r=this;l.indexOf(e)>=0&&t instanceof Function&&Signals.connect("__MODEL__"+r._p.getProp("modelName"),e,t)},off:function(e,t){var r=this;l.indexOf(e)>=0&&t instanceof Function&&Signals.disconnect("__MODEL__"+r._p.getProp("modelName"),e,t)},getByField:function(e,r){var n,i,o=this._p.getProp("modelName");return u[o]&&u[o].indexes&&u[o].indexes.getKey&&null!=(n=u[o].indexes.getKey(e,r))&&u[o].cache.records&&u[o].cache.records[n]?(i=u[o].cache.records[n],new t(o,[i]).first()):null},objects:function(e){var r=this._p.getProp("modelName"),n=[];return u[r]&&Array.isArray(u[r].cache.records)&&(n=e&&e instanceof Function?u[r].cache.records.filter(e):u[r].cache.records),new t(r,n)},success:function(e){var t=this;return u[t._p.getProp("modelName")].proxy.setSuccess(e),t},error:function(e){var t=this;return u[t._p.getProp("modelName")].proxy.setError(e),t},setParams:function(e){var t=this;e=e||{},u[t._p.getProp("modelName")].proxy.params=e}},(n=function(e,t){var r=this;r.type=e||"string",r.option=t||{},r.option.decimal=r.option.decimal||0,r.option.foreignKey=r.option.foreignKey||"id"}).prototype={type:null,option:null,isForeign:function(){return"foreign"==this.type},bool:function(e){return"1"!==e&&"0"!==e||(e=parseInt(e)),!!e},string:function(e){return e?e.toString():""},integer:function(e){return e?parseInt(e):0},number:function(e){var t=this;return t.option.decimal?Math.round(parseFloat(e)*Math.pow(10,t.option.decimal))/Math.pow(10,t.option.decimal):parseFloat(e)},date:function(e){return e?new Date(e):null},foreign:function(e){var t,r=this;if(!(t=Model(r.option.model)))throw'Model "'+r.option.model+'" is not defined';return t.getByField(r.option.foreignKey,e)},transform:function(e){var t=this;if("string"==t.type)return t.string(e);if("integer"==t.type)return t.integer(e);if("number"==t.type)return t.number(e);if("date"==t.type)return t.date(e);if("foreign"==t.type)return t.foreign(e);if("bool"==t.type)return t.bool(e);throw"Model. Type field is not defined"}},(Model=function(t){return u.hasOwnProperty(t)?new e(t):null}).register=function(e,t){t.proxy=t.proxy||{},t.index=t.index||[],u[e]={classObj:t,cache:[],indexes:{},proxy:null},u[e].proxy=new o(e,t.proxy)},Model.fields={bool:function(e){return new n("bool",e)},string:function(e){return new n("string",e)},integer:function(e){return new n("integer",e)},number:function(e){return new n("number",e)},date:function(e){return new n("date",e)},foreign:function(e){return e=e||{},e.model=e.model||null,e.type=e.type||Model.fields.integer(),new n("foreign",e)}}}();var Signals=function(e){function t(){return"development"==h}function r(e,t){var r=this;r._i=e,r._fn=t}function n(e,t,n){var i=!1,o=!1,a=null;return{ns:e,name:t,names:t.split("."),args:n,stopPropagation:function(){i=!0},isStop:function(){return i},freeze:function(){o=!0},unfreeze:function(){var e=a;o=!1,a=null,e&&e.keepOn()},isFreeze:function(){return o},registerFrezer:function(e){o&&e instanceof r&&(a=e)}}}function i(e,t,r){if(g[e][t]=g[e][t]||[],void 0===g[e][t].count&&(g[e][t].count=10),g[e][t].indexOf(r)>=0){if(g[e][t].count--,g[e][t].count<0)throw o(e,t),'Signals. !!!Collision!!! Trigger "'+t+'" go to recursion.'}else g[e][t].push(r)}function o(e,t){delete g[e][t]}function a(e){return f[e]=f[e]||{},g[e]=g[e]||{},f[e]}function s(e){var t,r=e;return e.indexOf(".")>=0&&(r=[],e.split(".").forEach(function(e){t?(t=t+"."+e,r.push(t)):(t=e,r.push(e))})),r}function u(e,t){var r,n=[];return r=a(e),"string"==typeof(t=s(t))?(r[t]=r[t]||[],n=r[t]):Array.isArray(t)&&t.forEach(function(e){r[e]=r[e]||[],n.push.apply(n,r[e])}),n.sort(function(e,t){return e._priority-t._priority}),n}function l(e,t,r,n){var i;"function"==typeof r&&(void 0===n&&(n=0),r._priority=n,(i=a(e))[t]=i[t]||[],i[t].indexOf(r)<0&&i[t].push(r))}function c(e,t,r){var n,i;"function"==typeof r&&(n=a(e))[t]&&((i=n[t].indexOf(r))>=0&&n[t].splice(i,1),0==n[t].length&&(delete n[t],delete g[t]))}function d(e,t){var r;(r=a(e))[t]&&(delete r[t],delete g[t])}function p(e,a){function s(n){var u,d=0;for(void 0!==n&&(d=n+1);d<c.length;d++){if(l.isStop())return void o(e,a);u=c[d],i(e,a,u);try{u.apply(l,l.args)}catch(e){t()&&(console.error("Error on Signals Calling",e),console.info("Dump idx : ",n),console.info("Dump fn : ",u),console.info("Dump trigger (t) : ",l),console.info("Dump arguments : ",l.args))}if(l.isFreeze())return void l.registerFrezer(new r(d,s));c.length-1==d&&o(e,a)}}var l,s,c=u(e,a),d=[];d.push.apply(d,arguments),d=d.splice(2),l=new n(e,a,d),s()}if(e)return e;var a,u,l,c,s,p,i,o,r,n,f={},g={},h="production";return r.prototype={_i:0,_fn:null,keepOn:function(){var e=this;e._fn(e._i)},isInstance:function(e){return e instanceof r}},e={setEnvironmentStage:function(e){h=e||h},create:function(e){var t=this,r=e||{}.set_id();return{parent:t,getNameSpace:function(){return r},on:function(){var e=this,n=[];return n.push.apply(n,arguments),n.unshift(r),t.on.apply(t,n),e},off:function(){var e=this,n=[];return n.push.apply(n,arguments),n.unshift(r),t.off.apply(t,n),e},clearAll:function(){var e=this,n=[];return n.push.apply(n,arguments),n.unshift(r),t.clearAll.apply(t,n),e},trigger:function(){var e=this,n=[];return n.push.apply(n,arguments),n.unshift(r),t.trigger.apply(t,n),e}}},on:function(){var e=this;return l.apply(l,arguments),e},off:function(){var e=this;return c.apply(c,arguments),e},clearAll:function(){var e=this;return d.apply(d,arguments),e},trigger:function(){var e=this;return p.apply(p,arguments),e},connect:function(){var e=this;return e.on.apply(e,arguments),e},disconnect:function(){var e=this;return e.off.apply(e,arguments),e},signal:function(){var e=this;return e.trigger.apply(e,arguments),e}}}(Signals);String.prototype.replace_all=function(e,t){var r=this.valueOf();for(e=e||"",t=t||"";r.indexOf(e)>=0;)r=r.replace(e,t);return r},window._id_counter=-1,Object.prototype.hasOwnProperty("_id")||Object.defineProperty(Object.prototype,"_id",{value:"",enumerable:!1,writable:!0}),Object.prototype.hasOwnProperty("set_id")||Object.defineProperty(Object.prototype,"set_id",{value:function(e){var t=this;return e?t._id=e:(window._id_counter++,t._id="__"+window._id_counter+"__"),t._id},enumerable:!1,writable:!1}),Object.prototype.hasOwnProperty("get_id")||Object.defineProperty(Object.prototype,"get_id",{value:function(){return this._id},enumerable:!1,writable:!1}),Object.prototype.hasOwnProperty("forIn")||Object.defineProperty(Object.prototype,"forIn",{value:function(e){var t,r=this;if(e)for(t in r)e(t,r[t])},enumerable:!1,writable:!1}),Object.prototype.hasOwnProperty("forBack")||Object.defineProperty(Object.prototype,"forBack",{value:function(e){var t,r=this;for(t=r.length-1;t>=0;t--)e(r[t],t,r)},enumerable:!1,writable:!1}),Array.prototype.hasOwnProperty("clone")||Object.defineProperty(Array.prototype,"clone",{value:function(){var e,t=this,r=[];for(e=0;e<t.length;e++)t[e]instanceof Array?r.push(t[e].clone()):t[e]instanceof Object?r.push(t[e].copy()):r.push(t[e]);return r},enumerable:!1,writable:!1}),angular.module("moto.directive",[]),angular.module("moto.directive").directive("motoAutoFocus",["$timeout",function(e){return{restrict:"A",priority:1e3,link:function(t,r,n){var i;try{i=angular.fromJson(n.motoAutoFocus).delay}catch(e){}e(function(){var e=r[0];e.focus&&e.focus(),e.selectionStart=e.selectionEnd=e.value?e.value.length:0},i||500)}}}]),angular.module("moto.directive").directive("motoDefaultValue",function(){return{restrict:"A",priority:451,require:"ngModel",link:function(e,t,r,n){var i;i=function(){n.$modelValue||(t.val(r.motoDefaultValue),n.$setViewValue(r.motoDefaultValue)),e.$$phase||e.$apply()},r.$observe("motoDefaultValue",i),t.bind("blur",i),e.$on("$destroy",function(){t.unbind("blur",i)})}}}),angular.module("moto.directive").directive("motoEventLast",function(){return{restrict:"A",link:function(e,t,r){r.motoEventLast&&e.$last&&e.$evalAsync(function(){e.$emit(r.motoEventLast,e,t,r)})}}}),angular.module("moto.directive").filter("motoFileSize",["coreLibraryUtils",function(e){return function(t){return angular.isNumber(t)&&(t=e.fileSize(t).replace(/\.00/,"")),t}}]),angular.module("moto.directive").directive("motoInitSortable",[function(){return{restrict:"A",scope:{sortableItems:"=motoInitSortable",placeholderClass:"<sortablePlaceholderClass",onStartSorting:"<onStartSorting",onChangeSorting:"<onChangeSorting",onStopSorting:"<onStopSorting"},link:function(e,t){var r,n,i,o,a,s;angular.isArray(e.sortableItems)&&(t.sortable({placeholder:e.placeholderClass||"sortable-place-highlight",cursor:"move",start:function(t,o){r=o.item.attr("item-id"),n=$(this).sortable("toArray",{attribute:"item-id"}),i=n.indexOf(r),s=e.sortableItems[i],angular.isFunction(e.onStartSorting)&&e.onStartSorting({item:s,itemId:r,itemNode:o.item,currentIndex:i,currentIndexes:n})},change:function(t,u){angular.isFunction(e.onChangeSorting)&&(o=$(this).sortable("toArray",{attribute:"item-id"}),a=o.indexOf(r),e.onChangeSorting({item:s,itemId:r,itemNode:u.item,newIndex:i,newIndexes:o,previousIndex:i,previousIndexes:n}))},stop:function(t,u){o=$(this).sortable("toArray",{attribute:"item-id"}),a=o.indexOf(r),s=e.sortableItems[i],a!==i&&(e.sortableItems.splice(i,1),e.sortableItems.splice(a,0,s)),angular.isFunction(e.onStopSorting)&&e.onStopSorting({item:s,itemId:r,itemNode:u.item,newIndex:a,newIndexes:o,previousIndex:i,previousIndexes:n}),e.$$phase||e.$apply()}}),e.$on("$destroy",function(){t.sortable("destroy")}))}}}]),angular.module("moto.directive").directive("motoInputCounter",["$compile",function(e){return{restrict:"A",scope:{ngModel:"<"},link:function(t,r,n){var i=e('<span class="moto-input-counter" style="display:none"><span class="moto-input-counter-current">{{ ngModel.length }}</span>/<span class="moto-input-counter-max" ng-class="{\'moto-input-counter-max_warning\' : ngModel.length >= maxChars}">{{ maxChars }}</span></span>')(t);t.maxChars=parseInt(n.maxlength)||1/0,r.after(i),r.on("focus",function(){i.show()}),r.on("blur",function(){i.hide()})}}}]),angular.module("moto.directive").directive("motoMaskInput",["$timeout",function(e){return{priority:450,restrict:"A",require:"ngModel",link:function(t,r,n,i){function o(){var t=null;i.$setViewValue(i.$modelValue),e(function(){this.selectionStart&&this.selectionEnd&&this.setSelectionRange&&(t={start:this.selectionStart}),r.val()!=i.$modelValue&&(r.val(i.$modelValue),t&&this.setSelectionRange(t.start-1,t.start-1))}.bind(this),0)}var a,s;n.ngTrim||n.$set("ngTrim","false");try{a=t.$eval(n.motoMaskInput)}catch(e){a=n.motoMaskInput}!a||a.length<1||(s=new RegExp("(["+a+"]+)","g"),i.$parsers.push(function(e){return e&&(e=e.replace(s,"")),e}),r.bind("input propertychange",o),t.$on("$destroy",function(){r.unbind("input propertychange",o)}))}}}]),angular.module("moto.directive").directive("motoSortableWidgets",[function(){return{restrict:"A",link:function(e,t){var r,n;t.sortable({placeholder:"sortable-place-highlight",cursor:"move",start:function(t,i){r=e.MotoEditor.getWidgetById(i.item.attr("item-id")),n=r.getPositionIndexInContainer()},stop:function(){var t;t=$(this).sortable("toArray",{attribute:"item-id"}).indexOf(r.getId()),n!==t&&(n<t&&t++,e.MotoEditor.ContentManager.insertOrMoveWidgetByOptions({droppedWidgetOptions:{widget:r,widgetName:r.name},targetConfig:{targetWidgetId:r._parent.getId(),indexInContainer:t}}))}}),e.$on("$destroy",function(){t.sortable("destroy")})}}}]),angular.module("moto.directive").directive("motoSrcObserver",function(){return{restrict:"A",link:function(e,t,r){function n(){if(angular.isDefined(r.motoErrorSrc)&&r.src!==r.motoErrorSrc&&r.$set("src",app.config.getPath(r.motoErrorSrc)),angular.isDefined(r.onMotoErrorSrc)){try{e.$eval(r.onMotoErrorSrc)}catch(e){}e.$$phase||e.$apply()}o()}function i(){if(angular.isDefined(r.onMotoLoadSrc)){try{e.$eval(r.onMotoLoadSrc)}catch(e){}e.$$phase||e.$apply()}o()}var o;t.on("error",n),t.on("load",i),o=function(){t.off("error",n),t.off("load",i)},e.$on("$destroy",o)}}}),angular.module("moto.directive").filter("motoTruncateString",function(){return function(e,t,r){return r=r||"...",(isNaN(t)||t<r.length+1)&&(t=10),e.length>t&&(e=e.substr(0,t-r.length)+r),e}}),angular.module("core.library.tutorial").directive("motoTutorialButton",["coreLibraryTutorial",function(e){return{restrict:"E",scope:!0,template:'<a ng-show="enabled" class="view-site" ng-click="openModal()"><span class="tutorial"><i class="tutorial-icon fa fa-book" data-uk-tooltip="{pos: \'bottom-right\', cls: \'general-tip\'}" title="{{ \'COMMON.BUTTON.TUTORIAL\' | translate }}"></i>{{ \'COMMON.BUTTON.TUTORIAL\' | translate}}</span></a>',link:function(t,r,n){t.enabled=e.isEnabled(),t.openModal=function(){e.open(n.section)},t.$on("tutorialStatusChanged",function(e,r){t.enabled=r})}}}]),angular.module("moto.directive").directive("motoUrlInputFilter",function(){return{restrict:"A",priority:500,require:"ngModel",link:function(e,t,r,n){function i(e){return s.clear_protocol&&(e=e.replace(/^.*\/\//,"/")),s.clear_domain&&(e=e.replace(/^\/?((?=[a-z0-9-]{1,63}\.)(xn--)?[a-z0-9]+(-[a-z0-9]+)*\.)+([a-z]{2,63})(:[0-9]+)?/,function(){return $.inArray(arguments[4],["htm","html","php"])>=0?arguments[0]:""})),s.clear_start_dot&&(e=e.replace(/^\.+/,"")),e}function o(){var e,r,o;t.is(":focus")&&(o=i(n.$modelValue),e=t.val().length-o.length,r=t[0].selectionStart-e,t.val(o),n.$setViewValue(o),t[0].setSelectionRange(r,r))}function a(){var e;e=i(n.$modelValue),t.val(e),n.$setViewValue(e)}var s=e.$eval(r.motoUrlInputFilter);t.bind("blur",a),t.closest("form").bind("submit",o),e.$on("$destroy",function(){t.unbind("blur",a),t.closest("form").unbind("submit",o)})}}});